<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="google-site-verification" content="zn35ZLEP0On5fOgBn4JhRUUvkwCf7aHCy5sF7KY_ztQ" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta name="baidu-site-verification" content="codeva-zj1hmU1TBt" />
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="greendolphindance">
    
        
                
                    <meta name="description" content="Back to the rough ground!">
                    
                        
                                
                                    <title>
                                        
                                                    制作hexo热力图 | 
                                                            Green Dolphin Dance
                                    </title>

                                    
                                        
                                            <link rel="icon" href="https://github.com/greendolphindance/greendolphindance.github.io/assets/87912044/c65c5411-e5b5-4b25-b756-1a3121e22467">
                                            

                                                
                                                    
                                                        <!-- stylesheets list from _config.yml -->
                                                        
                                                            <link rel="stylesheet" href="/css/style.css">
                                                            
                                                                
                                                                    
                                                                        
                                                                            <!-- scripts list from _config.yml -->
                                                                            
                                                                                <script
                                                                                    src="/js/echarts.js"></script>
                                                                                
                                                                                <script
                                                                                    src="/js/script.js"></script>
                                                                                
                                                                                <script
                                                                                    src="/js/tocbot.min.js"></script>
                                                                                
                                                                                <script
                                                                                    src="/js/jquery.js"></script>
                                                                                
                                                                                <script
                                                                                    src="/js/clipboard.min.js"></script>
                                                                                
                                                                                    
                                                                                        
                                                                                            
                                                                                                
                                                                                                    
                                                                                                                
                                                                                                                            
                                                                                                                                



                                                                                                                                    <script>
                                                                                                                                        document.addEventListener('DOMContentLoaded', function () {
                                                                                                                                            function changeGiscusTheme() {
                                                                                                                                                const theme = document.body.classList.contains('dark-theme') ? 'dark' : 'light';

                                                                                                                                                function sendMessage(message) {
                                                                                                                                                    const iframe = document.querySelector('iframe.giscus-frame');
                                                                                                                                                    if (!iframe) return;
                                                                                                                                                    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
                                                                                                                                                }

                                                                                                                                                sendMessage({
                                                                                                                                                    setConfig: {
                                                                                                                                                        theme: theme === 'dark' ? 'noborder_dark' : 'noborder_light'
                                                                                                                                                    }
                                                                                                                                                });
                                                                                                                                            }

                                                                                                                                            // 等待Giscus加载，然后尝试更改主题
                                                                                                                                            setTimeout(changeGiscusTheme, 1200); // 等待1200毫秒

                                                                                                                                            // 如果你有一个主题切换按钮或链接，你可以在这里添加事件监听器
                                                                                                                                            // 例如：
                                                                                                                                            // document.getElementById('your-theme-switch-button-id').addEventListener('click', changeGiscusTheme);
                                                                                                                                        });
                                                                                                                                    </script>

                                                                                                                                    <!-- 搜索的部分 -->
                                                                                                                                    

                                                                                                                                        
                                                                                                                                            <script>
    // function searchToggle() {
    //     const width = $(document.body).width()
    //     if(width > 479) {
    //         return;
    //     }
    //     const search = $('.search');
    //     const searchForm = $('.form-search')

    //     if(!search.hasClass("mobile-search")) {
    //         search.addClass("mobile-search");
    //     } else {
    //         search.removeClass("mobile-search");
    //     }
    // }

    function searchToggle() {
        const width = $(document.body).width()
        if (width > 900) {
            return;
        }
        const search = $('.search');
        const searchForm = $('.form-search');
        const menuToggle = $('.menu-toggle');
        const title = $('.navbar-header-title ');

        if (!search.hasClass("mobile-search")) {
            search.addClass("mobile-search");
            menuToggle.addClass("open-search")
            title.addClass("mobile-title-hidden")
        } else {
            search.removeClass("mobile-search");
            menuToggle.removeClass("open-search")
            // title.css({visibility: 'visible'})
            title.removeClass("mobile-title-hidden")
        }
    }



    function search(searchInputEl, formEl, flag) {
        const path = "/" + "search.json"; // 可以在public 下查看这个search.json
        $(formEl).submit(function (e) {
            e.preventDefault();
            let target = null
            if (searchInputEl == null) {
                const screenWidth = $(document.body).width();
                target = screenWidth > 479 ? $('#pc-search-input') : $('#mobile-search-input');
                console.log(target);
            } else {
                target = $(searchInputEl)
            }

            if (!flag && target.val() === '') {
                return;
            }

            $("#u-search").fadeIn(500, function () {
                $("body > .wrapper").addClass("modal-active");

                $.ajax({
                    url: path,
                    dataType: "json",
                    beforeSend: function (xhr) {
                        $input = target.val();
                        $(".form-input").val($input);
                        const loadingBar = $('.search-loading-bar')
                        loadingBar.css({
                            width: '100%',
                            display: 'block'
                        });
                    },
                    success: function (datas) {
                        console.log(datas);
                        const $resultPanel = $(".modal-body")[0];
                        let str = `<ul class="modal-results">`;
                        var keywords = $(".form-input").val().trim().toLowerCase().split(/[\s\-]+/);
                        $resultPanel.innerHTML = "";
                        let hasResult = false
                        let text = `<div class="no-result">找不到与关键词相关的内容....</div>`;

                        if ($(".form-input").val().trim().length <= 0) {
                            // 没有结果
                            $resultPanel.innerHTML = text;
                            return;
                        }
                        datas.forEach(function (data, index) {
                            var isMatch = true;
                            if (!data.title || data.title.trim() === '') {
                                data.title = "Untitled";
                            }
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content && data.content.trim().replace(/<[^>]+>/g, "").toLowerCase() || '';
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty contents
                            if (data_content !== '') {
                                keywords.forEach(function (keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);

                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        hasResult = true
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            } else {
                                isMatch = false;
                            }
                            // show search results
                            if (isMatch) {
                                str += `<li class='result-item'><a href='${data_url}' class='result-item-detail'> <span class="title">${data_title}</span>`;
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 200 characters
                                    var start = first_occur - 40;
                                    var end = first_occur + 160;

                                    if (start < 0) {
                                        start = 0;
                                    }

                                    if (start == 0) {
                                        end = 200;
                                    }

                                    if (end > content.length) {
                                        end = content.length;
                                    }

                                    var match_content = content.substring(start, end);

                                    // highlight all keywords
                                    keywords.forEach(function (keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, `<em class="search-keyword">${keyword}</em>`);
                                    });

                                    str += `<span class="content"> ${match_content} ...</span></a>`;
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        if (hasResult) {
                            $resultPanel.innerHTML = str;
                        } else {
                            $resultPanel.innerHTML = text;
                        }

                    },
                    complete: function () {
                        setTimeout(() => {
                            const loadingBar = $('.search-loading-bar')
                            loadingBar.css({
                                width: '0%',
                                display: 'none'
                            });
                        }, 300)
                    }
                });
            })

        });
    }

    $(document).ready(function () {
        $('.modal-close').click(function () {
            $("#u-search").fadeOut();
            $("body > .wrapper").removeClass("modal-active")
        })

        $('.modal-overlay').click(function () {
            $("#u-search").fadeOut();
            $("body > .wrapper").removeClass("modal-active")
        })
        search(null, ".form-search", false)
        search("#u-search-modal-form .form-input", ".u-search-modal-form", true)
    })
</script>
                                                                                                                                                

                                                                                                                                                    <script
                                                                                                                                                        async
                                                                                                                                                        src="https://us.umami.is/script.js"
                                                                                                                                                        data-website-id="38f19c51-0534-4438-abae-315f586a457d"></script>

                                                                                                                                                    <script
                                                                                                                                                        type="text/javascript"
        <style>
            body.hide-content * {
                visibility: hidden;
            }
        </style>
        <script>
            (function () {
                document.body.classList.add('hide-content');

                const savedTheme = localStorage.getItem('theme');
                const userPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                let useDarkMode;
                if (savedTheme === 'dark' || savedTheme === 'light') {
                    useDarkMode = savedTheme === 'dark';
                } else {
                    useDarkMode = userPrefersDark;
                }
                document.body.classList.toggle('dark-theme', useDarkMode);
                document.body.classList.remove('hide-content');
            })();
        </script>
        <style>
            #tocButton svg {
                position: fixed;
                bottom: 20px;
                /* 调整到你想要的位置 */
                right: 5vw;
            }

            #totop {
                position: fixed;
                bottom: 20px+2rem;
                /* 调整到你想要的位置 */
                right: 5vw;
            }
        </style>

<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Green Dolphin Dance" type="application/atom+xml">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-solarized-dark-atom.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">
                    Green Dolphin Dance
                </a></div>
            <div class="menu navbar-right">
                <!-- 这里表示的是pc端搜索框 -->
                
                    
    <div class="search ">
        <div class="search-btn" onClick="searchToggle()">
            <svg t="1703126001771" class="search-btn-img" viewBox="0 0 1024 1024" version="1.1"
                xmlns="http://www.w3.org/2000/svg" p-id="4319" width="200" height="200">
                <path
                    d="M1004.8 915.2l-243.2-243.2c0 0-6.4-6.4-6.4-6.4C800 595.2 832 505.6 832 416 832 185.6 646.4 0 416 0S0 185.6 0 416 185.6 832 416 832c89.6 0 179.2-32 243.2-83.2 0 6.4 6.4 6.4 6.4 6.4l243.2 243.2c25.6 25.6 70.4 25.6 96 6.4C1030.4 979.2 1030.4 940.8 1004.8 915.2zM64 416C64 224 224 64 416 64S768 224 768 416 608 768 416 768 64 608 64 416z"
                    fill="#161209" p-id="4320"></path>
            </svg>
        </div>
        <form class="form-search">
            <input class="input" placeholder="点此搜索" autocomplete="off" id="pc-search-input" />
        </form>
    </div>
    

        <style>
            body.dark-theme .search-btn-img path {
                fill: #a9a9b3;
                /* 淡灰色 */
            }
        </style>
                        
                            <a class="menu-item" href="/timeline">
                                动态
                            </a>
                            
                            <a class="menu-item" href="/archives">
                                归档
                            </a>
                            
                            <a class="menu-item" href="/categories">
                                分类
                            </a>
                            
                            <a class="menu-item" href="/tags">
                                标签
                            </a>
                            
                            <a class="menu-item" href="/songs">
                                音乐
                            </a>
                            
                            <a class="menu-item" href="/guestbook">
                                留言板
                            </a>
                            
                            <a class="menu-item" href="/about">
                                关于
                            </a>
                            
                            <a class="menu-item" href="/links">
                                友链
                            </a>
                            
                                <input id="switch_default" type="checkbox" class="switch_default">
                                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="/">
                            Green Dolphin Dance
                        </a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                    </div>
                    <div class="navbar-mobile-right">
                        
                            
    <div class="search ">
        <div class="search-btn" onClick="searchToggle()">
            <svg t="1703126001771" class="search-btn-img" viewBox="0 0 1024 1024" version="1.1"
                xmlns="http://www.w3.org/2000/svg" p-id="4319" width="200" height="200">
                <path
                    d="M1004.8 915.2l-243.2-243.2c0 0-6.4-6.4-6.4-6.4C800 595.2 832 505.6 832 416 832 185.6 646.4 0 416 0S0 185.6 0 416 185.6 832 416 832c89.6 0 179.2-32 243.2-83.2 0 6.4 6.4 6.4 6.4 6.4l243.2 243.2c25.6 25.6 70.4 25.6 96 6.4C1030.4 979.2 1030.4 940.8 1004.8 915.2zM64 416C64 224 224 64 416 64S768 224 768 416 608 768 416 768 64 608 64 416z"
                    fill="#161209" p-id="4320"></path>
            </svg>
        </div>
        <form class="form-search">
            <input class="input" placeholder="点此搜索" autocomplete="off" id="mobile-search-input" />
        </form>
    </div>
    

        <style>
            body.dark-theme .search-btn-img path {
                fill: #a9a9b3;
                /* 淡灰色 */
            }
        </style>
                                <div class="menu-toggle" onclick="mobileBtn()">&#9776; 目录</div>
                    </div>

                    <div class="menu" id="mobile-menu">
                        
                            <a class="menu-item" href="/timeline">
                                动态
                            </a>
                            
                            <a class="menu-item" href="/archives">
                                归档
                            </a>
                            
                            <a class="menu-item" href="/categories">
                                分类
                            </a>
                            
                            <a class="menu-item" href="/tags">
                                标签
                            </a>
                            
                            <a class="menu-item" href="/songs">
                                音乐
                            </a>
                            
                            <a class="menu-item" href="/guestbook">
                                留言板
                            </a>
                            
                            <a class="menu-item" href="/about">
                                关于
                            </a>
                            
                            <a class="menu-item" href="/links">
                                友链
                            </a>
                            
                    </div>
                </div>
        </nav>




</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.classList.contains("active")) {
            toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        } else {
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
        

                    
                        <article class="post-wrap">
                            <header class="post-header">
                                <h1 class="post-title">
                                    制作hexo热力图
                                </h1>
                                
                                    <div class="post-meta">

                                        

                                                
                                                    <span class="post-time">

                                                        发表时间: <a href="#">2024-01-22&nbsp;&nbsp;21:21:33</a>
                                                    </span>
                                                    

                                                        
                                                            <span class="updated-time">
                                                                最后更新: <a href="#">2024-07-17&nbsp;&nbsp;22:01:21</a>
                                                            </span>
                                                            



                                                                

                                                                    <span class="post-category">

                                                                        分类:

                                                                        

                                                                            <a href="/categories/%E6%8A%98%E8%85%BE/">折腾</a>

                                                                            

                                                                    </span>

                                                                    



                                                                        

                                                                            <span class="post-count">

                                                                                字数:

                                                                                <a href="">
                                                                                    5.4k
                                                                                </a>

                                                                            </span>

                                                                            



                                                                                

                                                                                    <span class="post-count">

                                                                                        阅读时长:

                                                                                        <a href="">
                                                                                            29min
                                                                                        </a>

                                                                                    </span>

                                                                                    

                                    </div>
                                    
                            </header>

                            <div class="post-content">
                                <p>又是cyx！告诉了我<a target="_blank" rel="noopener" href="https://blog.douchi.space/hugo-blog-heatmap/#gsc.tab=0">有个人的博客</a>做了热力图。我一开始没想做，因为我博文更新没那么勤，热力图做出来恐怕不会好看。但是到了晚上，我的折腾之心开始蠢蠢欲动！于是喊GPT帮我做。当天晚上debug到凌晨四点，还是没能做出来。今天跟cyx喝了个咖啡，回来继续捣鼓，居然成了！</p>
<h1 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h1><p>话不多说，放一下我的完整代码，这是在profile.ejs文件里的，因为我想把热力图放在主页的标题上方。</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container profile-container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"intro"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"avatar"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&lt;%- url_for(theme.nav.Posts) %&gt;"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&lt;%- url_for(theme.avatar) %&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"heatmap-container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://d3js.org/d3.v5.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">"DOMContentLoaded"</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">function</span> <span class="title function_">getDateBefore</span>(<span class="params">days</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="keyword">new</span> <span class="title class_">Date</span>();</span></span><br><span class="line"><span class="language-javascript">                    currentDate.<span class="title function_">setDate</span>(currentDate.<span class="title function_">getDate</span>() - days);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> year = currentDate.<span class="title function_">getFullYear</span>();</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> month = <span class="title class_">String</span>(currentDate.<span class="title function_">getMonth</span>() + <span class="number">1</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> day = <span class="title class_">String</span>(currentDate.<span class="title function_">getDate</span>()).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="string">`<span class="subst">${year}</span>-<span class="subst">${month}</span>-<span class="subst">${day}</span>`</span>;</span></span><br><span class="line"><span class="language-javascript">                }</span></span><br><span class="line"><span class="language-javascript">            &lt;%</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">function</span> <span class="title function_">convertWordCount</span>(<span class="params">wordCountString</span>) {</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (!wordCountString) {</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">                        }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// Convert to string and check if the word count string contains 'k'</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> lowerCaseString = <span class="title class_">String</span>(wordCountString).<span class="title function_">toLowerCase</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (lowerCaseString.<span class="title function_">includes</span>(<span class="string">'k'</span>)) {</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> <span class="built_in">parseFloat</span>(lowerCaseString) * <span class="number">1000</span>;</span></span><br><span class="line"><span class="language-javascript">                        } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> <span class="built_in">parseFloat</span>(lowerCaseString);</span></span><br><span class="line"><span class="language-javascript">                        }</span></span><br><span class="line"><span class="language-javascript">                    }</span></span><br><span class="line"><span class="language-javascript">                    %&gt;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> data = [</span></span><br><span class="line"><span class="language-javascript">    &lt;% site.<span class="property">posts</span>.<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params">post</span>) { %&gt;</span></span><br><span class="line"><span class="language-javascript">                        {</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">date</span>: <span class="string">"&lt;%= post.date.format('YYYY-MM-DD') %&gt;"</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">word_count</span>: &lt;%= <span class="title function_">convertWordCount</span>(<span class="title function_">getWordCount</span>(post.<span class="property">content</span>)) %&gt;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">link</span>: <span class="string">"&lt;%= url_for(post.path) %&gt;"</span></span></span><br><span class="line"><span class="language-javascript">        },</span></span><br><span class="line"><span class="language-javascript">    &lt;% }); %&gt;</span></span><br><span class="line"><span class="language-javascript">];</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> margin = { <span class="attr">top</span>: <span class="number">20</span>, <span class="attr">right</span>: <span class="number">20</span>, <span class="attr">bottom</span>: <span class="number">20</span>, <span class="attr">left</span>: <span class="number">20</span> };</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> containerWidth = <span class="number">600</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> cellSize = <span class="title class_">Math</span>.<span class="title function_">min</span>((containerWidth - margin.<span class="property">left</span> - margin.<span class="property">right</span>) / <span class="number">45</span>, (containerWidth - margin.<span class="property">top</span> - margin.<span class="property">bottom</span>) / <span class="number">8</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> width = cellSize * <span class="number">45</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> height = cellSize * <span class="number">8</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> svg = d3</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">select</span>(<span class="string">"#heatmap-container"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">append</span>(<span class="string">"svg"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"width"</span>, width + margin.<span class="property">left</span> + margin.<span class="property">right</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"height"</span>, height + margin.<span class="property">top</span> + margin.<span class="property">bottom</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">append</span>(<span class="string">"g"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"transform"</span>, <span class="string">"translate("</span> + margin.<span class="property">left</span> + <span class="string">","</span> + margin.<span class="property">top</span> + <span class="string">")"</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> xScale = d3.<span class="title function_">scaleBand</span>().<span class="title function_">range</span>([width, <span class="number">0</span>]).<span class="title function_">padding</span>(<span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> yScale = d3.<span class="title function_">scaleBand</span>().<span class="title function_">range</span>([height, <span class="number">0</span>]).<span class="title function_">padding</span>(<span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> exponent = <span class="number">0.3</span>; <span class="comment">// Adjust the exponent as needed</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> colorScale = d3.<span class="title function_">scaleSequential</span>(d3.<span class="title function_">interpolate</span>(<span class="string">"lightblue"</span>, <span class="string">"#2d96bd"</span>))</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">domain</span>([<span class="number">1</span>, <span class="title class_">Math</span>.<span class="title function_">pow</span>(d3.<span class="title function_">max</span>(data, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> d.<span class="property">word_count</span>; }), exponent)]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            xScale.<span class="title function_">domain</span>(d3.<span class="title function_">range</span>(<span class="number">45</span>));</span></span><br><span class="line"><span class="language-javascript">            yScale.<span class="title function_">domain</span>(d3.<span class="title function_">range</span>(<span class="number">8</span>));</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 在渲染每个格子时设置渐变色的值</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> cells = svg.<span class="title function_">selectAll</span>(<span class="string">".cell"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">data</span>(d3.<span class="title function_">cross</span>(d3.<span class="title function_">range</span>(<span class="number">8</span>), d3.<span class="title function_">range</span>(<span class="number">45</span>)))</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">enter</span>().<span class="title function_">append</span>(<span class="string">"a"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"href"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? correspondingData.<span class="property">link</span> : <span class="string">"#"</span>; <span class="comment">// 设置链接，如果没有链接就是 "#"，即当前页面</span></span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">append</span>(<span class="string">"rect"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"class"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="string">"cell"</span> + (correspondingData &amp;&amp; correspondingData.<span class="property">word_count</span> &gt; <span class="number">0</span> ? <span class="string">" blue"</span> : <span class="string">""</span>);</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"x"</span>, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> <span class="title function_">xScale</span>(d[<span class="number">1</span>]); })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"y"</span>, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> <span class="title function_">yScale</span>(d[<span class="number">0</span>]); })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"width"</span>, cellSize)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"height"</span>, cellSize)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">style</span>(<span class="string">"fill"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? <span class="title function_">colorScale</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(correspondingData.<span class="property">word_count</span>, exponent)) : <span class="string">"#ccc"</span>;</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"rx"</span>, <span class="number">4</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"ry"</span>, <span class="number">4</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"data-word_count"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? correspondingData.<span class="property">word_count</span> : <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">on</span>(<span class="string">"click"</span>, <span class="keyword">function</span> (<span class="params">event, d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (correspondingData &amp;&amp; correspondingData.<span class="property">link</span>) {</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = correspondingData.<span class="property">link</span>;</span></span><br><span class="line"><span class="language-javascript">                    }</span></span><br><span class="line"><span class="language-javascript">                });</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">function</span> <span class="title function_">updateCellStyles</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> isDarkTheme = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">"dark-theme"</span>);</span></span><br><span class="line"><span class="language-javascript">                cells.<span class="title function_">style</span>(<span class="string">"stroke"</span>, isDarkTheme ? <span class="string">"#292a2d"</span> : <span class="string">"#fff"</span>)</span></span><br><span class="line"><span class="language-javascript">                    .<span class="title function_">style</span>(<span class="string">"stroke-width"</span>, <span class="string">"1px"</span>);</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">updateCellStyles</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">addEventListener</span>(<span class="string">"themechange"</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">updateCellStyles</span>();</span></span><br><span class="line"><span class="language-javascript">            });</span></span><br><span class="line"><span class="language-javascript">        });</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">767px</span>) {</span></span><br><span class="line"><span class="language-css">                <span class="selector-id">#heatmap-container</span> {</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">                }</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="comment">/* 在桌面端时隐藏 .avatar */</span></span></span><br><span class="line"><span class="language-css">            <span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">768px</span>) {</span></span><br><span class="line"><span class="language-css">                <span class="selector-class">.avatar</span> {</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">                }</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.cell</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke</span>: <span class="number">#fff</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke-width</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">fill</span>: <span class="number">#ccc</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: default;</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 添加这一行 */</span></span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.dark-theme</span> <span class="selector-class">.cell</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke</span>: <span class="number">#292a2d</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke-width</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">fill</span>: <span class="number">#a9a9b3</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: default;</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 添加这一行 */</span></span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.blue</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.dark-theme</span> <span class="selector-class">.blue</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nickname"</span>&gt;</span>&lt;%- theme.nickname %&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"description"</span>&gt;</span>&lt;%- markdown(theme.description) %&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"links"</span>&gt;</span></span><br><span class="line">            &lt;% if (theme.links !==undefined) { %&gt;</span><br><span class="line">                &lt;% for (var key in theme.links){ %&gt;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"link-item"</span> <span class="attr">title</span>=<span class="string">"&lt;%- key %&gt;"</span> <span class="attr">href</span>=<span class="string">"&lt;%= theme.links[key] %&gt;"</span>&gt;</span></span><br><span class="line">                        &lt;% if(theme.links_text_enable) { %&gt;</span><br><span class="line">                            &lt;%= key %&gt;</span><br><span class="line">                                &lt;% } %&gt;</span><br><span class="line">                                    &lt;% if(theme.links_icon_enable){ %&gt;</span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"iconfont icon-&lt;%- key.toLowerCase() %&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        &lt;% } %&gt;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    &lt;% } %&gt;</span><br><span class="line">                        &lt;% } %&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>那个博主用的是echart库，我捣鼓了半天也未能成功，于是改用GPT推荐的D3库。然后我不想添加热力图标题、月份和星期等等文字内容，以适应我博客的极简风格，所以就没有加入这些东西，只设置了8*45=360个格子，展示我约一年来发博的情况。没有文章的时候为灰色，有文章的时候根据文章的字数显示为渐变的蓝色，最深为#2d96bd色，最浅为lightblue色。</p>
<p>此外，由于手机上显示的状况不佳，我希望在屏幕宽度为768像素以下时，不显示热力图，而显示我的照片：</p>
<figure class="highlight css"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">767px</span>) {</span><br><span class="line">    <span class="selector-id">#heatmap-container</span> {</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 在桌面端时隐藏 .avatar */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">768px</span>) {</span><br><span class="line">    <span class="selector-class">.avatar</span> {</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>关于数据的抓取，我是用如下代码实现的：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [</span><br><span class="line">    &lt;% page.<span class="property">posts</span>.<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params">post</span>) { %&gt;</span><br><span class="line">        {</span><br><span class="line">            <span class="attr">date</span>: <span class="string">"&lt;%= post.date.format('YYYY-MM-DD') %&gt;"</span>,</span><br><span class="line">            <span class="attr">word_count</span>: &lt;%= <span class="title function_">convertWordCount</span>(<span class="title function_">getWordCount</span>(post.<span class="property">content</span>)) %&gt;,</span><br><span class="line">            <span class="attr">link</span>: <span class="string">"&lt;%= url_for(post.path) %&gt;"</span></span><br><span class="line">        },</span><br><span class="line">    &lt;% }); %&gt;</span><br><span class="line">];</span><br></pre></td></tr></tbody></table></figure>

<p>其中，getWordCount函数是hexo-wordcount插件里带的，如果想复刻我的代码，需要先安装这个插件。</p>
<p>其实一开始就想能够自动抓取了，但是一直不成功，于是改成了手动输入。但是又太麻烦，就又开始捣鼓自动抓取的事情。但无论怎么弄都成功不了，GPT也找不出问题。于是求助我男朋友。他发现了两个错误：（1）我抓取的字数格式是形如2.8k的，而需要的数据是形如2800的。（2）我在代码的有些地方用了words，在另一些地方用了word_count（估计是我开了很多新窗口让GPT给了我很多次代码，然后搞混了）。改正这两个错误后，热力图就正常显示了。（在此感谢！）</p>
<p>还有一些细节：设置了点击跳转的逻辑后，我发现鼠标放在灰色的格子上时，也会变成手指的样式。我希望它在且仅在蓝色的格子上时才变成手指。代码里有一些是做这个事情的:</p>
<figure class="highlight css"><table><tbody><tr><td class="code"><pre><span class="line"><span class="selector-class">.blue</span> {</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dark-theme</span> <span class="selector-class">.blue</span> {</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>我部署上去后，在夜间模式是没效果的，所以加了后一段。但是我感觉按道理应该没必要加的？</p>
<p>以下这段代码是用来设置格子边框的样式的：</p>
<figure class="highlight css"><table><tbody><tr><td class="code"><pre><span class="line"><span class="selector-class">.cell</span> {</span><br><span class="line">    <span class="attribute">stroke</span>: <span class="number">#fff</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">stroke-width</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">fill</span>: <span class="number">#ccc</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: default;</span><br><span class="line">    <span class="comment">/* 添加这一行 */</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dark-theme</span> <span class="selector-class">.cell</span> {</span><br><span class="line">    <span class="attribute">stroke</span>: <span class="number">#292a2d</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">stroke-width</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">fill</span>: <span class="number">#a9a9b3</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: default;</span><br><span class="line">    <span class="comment">/* 添加这一行 */</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>因为在夜间模式的时候，格子边框起初也是白色，看起来很丑。这个也弄了很久，要么就是日间模式和夜间模式的框全变白，要么就全变黑。最后不记得是怎么解决的了。</p>
<p>热力图做好后，发现由于一篇文章的字数太多，其他文章的蓝色就变得很浅，而且只有微妙的区别。于是叫GPT修改代码：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">"DOMContentLoaded"</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    <span class="comment">// ... (previous code)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> exponent = <span class="number">0.3</span>; <span class="comment">// Adjust the exponent as needed</span></span><br><span class="line">    <span class="keyword">var</span> colorScale = d3.<span class="title function_">scaleSequential</span>(d3.<span class="title function_">interpolate</span>(<span class="string">"lightblue"</span>, <span class="string">"#2d96bd"</span>))</span><br><span class="line">        .<span class="title function_">domain</span>([<span class="number">1</span>, <span class="title class_">Math</span>.<span class="title function_">pow</span>(d3.<span class="title function_">max</span>(data, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> d.<span class="property">word_count</span>; }), exponent)]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... (remaining code)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> cells = svg.<span class="title function_">selectAll</span>(<span class="string">".cell"</span>)</span><br><span class="line">        .<span class="title function_">data</span>(d3.<span class="title function_">cross</span>(d3.<span class="title function_">range</span>(<span class="number">8</span>), d3.<span class="title function_">range</span>(<span class="number">45</span>)))</span><br><span class="line">        .<span class="title function_">enter</span>().<span class="title function_">append</span>(<span class="string">"a"</span>)</span><br><span class="line">        <span class="comment">// ... (remaining code)</span></span><br><span class="line">        .<span class="title function_">style</span>(<span class="string">"fill"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span><br><span class="line">            <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span><br><span class="line">            <span class="keyword">return</span> correspondingData ? <span class="title function_">colorScale</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(correspondingData.<span class="property">word_count</span>, exponent)) : <span class="string">"#ccc"</span>;</span><br><span class="line">        })</span><br><span class="line">        <span class="comment">// ... (remaining code)</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>我也看不懂，反正能跑。</p>
<p>至于D3相关代码，我是一点也不懂，就不妄加评论了。</p>
<p>就这样吧，想到什么再写！</p>
<h1 id="微调（2024-1-27）"><a href="#微调（2024-1-27）" class="headerlink" title="微调（2024-1-27）"></a>微调（2024-1-27）</h1><p>稍微调整了一下，把exponent改成了0.6，把lightblue改成了#add8e6。修改后的完整代码如下：</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container profile-container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"intro"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"avatar"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&lt;%- url_for(theme.nav.Posts) %&gt;"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&lt;%- url_for(theme.avatar) %&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"heatmap-container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://d3js.org/d3.v5.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">"DOMContentLoaded"</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">function</span> <span class="title function_">getDateBefore</span>(<span class="params">days</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="keyword">new</span> <span class="title class_">Date</span>();</span></span><br><span class="line"><span class="language-javascript">                    currentDate.<span class="title function_">setDate</span>(currentDate.<span class="title function_">getDate</span>() - days);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> year = currentDate.<span class="title function_">getFullYear</span>();</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> month = <span class="title class_">String</span>(currentDate.<span class="title function_">getMonth</span>() + <span class="number">1</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> day = <span class="title class_">String</span>(currentDate.<span class="title function_">getDate</span>()).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="string">`<span class="subst">${year}</span>-<span class="subst">${month}</span>-<span class="subst">${day}</span>`</span>;</span></span><br><span class="line"><span class="language-javascript">                }</span></span><br><span class="line"><span class="language-javascript">            &lt;%</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">function</span> <span class="title function_">convertWordCount</span>(<span class="params">wordCountString</span>) {</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (!wordCountString) {</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">                        }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// Convert to string and check if the word count string contains 'k'</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> lowerCaseString = <span class="title class_">String</span>(wordCountString).<span class="title function_">toLowerCase</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (lowerCaseString.<span class="title function_">includes</span>(<span class="string">'k'</span>)) {</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> <span class="built_in">parseFloat</span>(lowerCaseString) * <span class="number">1000</span>;</span></span><br><span class="line"><span class="language-javascript">                        } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> <span class="built_in">parseFloat</span>(lowerCaseString);</span></span><br><span class="line"><span class="language-javascript">                        }</span></span><br><span class="line"><span class="language-javascript">                    }</span></span><br><span class="line"><span class="language-javascript">                    %&gt;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> data = [</span></span><br><span class="line"><span class="language-javascript">    &lt;% site.<span class="property">posts</span>.<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params">post</span>) { %&gt;</span></span><br><span class="line"><span class="language-javascript">                        {</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">date</span>: <span class="string">"&lt;%= post.date.format('YYYY-MM-DD') %&gt;"</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">word_count</span>: &lt;%= <span class="title function_">convertWordCount</span>(<span class="title function_">getWordCount</span>(post.<span class="property">content</span>)) %&gt;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">link</span>: <span class="string">"&lt;%= url_for(post.path) %&gt;"</span></span></span><br><span class="line"><span class="language-javascript">        },</span></span><br><span class="line"><span class="language-javascript">    &lt;% }); %&gt;</span></span><br><span class="line"><span class="language-javascript">];</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> margin = { <span class="attr">top</span>: <span class="number">20</span>, <span class="attr">right</span>: <span class="number">20</span>, <span class="attr">bottom</span>: <span class="number">20</span>, <span class="attr">left</span>: <span class="number">20</span> };</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> containerWidth = <span class="number">600</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> cellSize = <span class="title class_">Math</span>.<span class="title function_">min</span>((containerWidth - margin.<span class="property">left</span> - margin.<span class="property">right</span>) / <span class="number">45</span>, (containerWidth - margin.<span class="property">top</span> - margin.<span class="property">bottom</span>) / <span class="number">8</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> width = cellSize * <span class="number">45</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> height = cellSize * <span class="number">8</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> svg = d3</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">select</span>(<span class="string">"#heatmap-container"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">append</span>(<span class="string">"svg"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"width"</span>, width + margin.<span class="property">left</span> + margin.<span class="property">right</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"height"</span>, height + margin.<span class="property">top</span> + margin.<span class="property">bottom</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">append</span>(<span class="string">"g"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"transform"</span>, <span class="string">"translate("</span> + margin.<span class="property">left</span> + <span class="string">","</span> + margin.<span class="property">top</span> + <span class="string">")"</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> xScale = d3.<span class="title function_">scaleBand</span>().<span class="title function_">range</span>([width, <span class="number">0</span>]).<span class="title function_">padding</span>(<span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> yScale = d3.<span class="title function_">scaleBand</span>().<span class="title function_">range</span>([height, <span class="number">0</span>]).<span class="title function_">padding</span>(<span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> exponent = <span class="number">0.6</span>; <span class="comment">// Adjust the exponent as needed</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> colorScale = d3.<span class="title function_">scaleSequential</span>(d3.<span class="title function_">interpolate</span>(<span class="string">"#add8e6"</span>, <span class="string">"#2d96bd"</span>))</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">domain</span>([<span class="number">1</span>, <span class="title class_">Math</span>.<span class="title function_">pow</span>(d3.<span class="title function_">max</span>(data, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> d.<span class="property">word_count</span>; }), exponent)]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            xScale.<span class="title function_">domain</span>(d3.<span class="title function_">range</span>(<span class="number">45</span>));</span></span><br><span class="line"><span class="language-javascript">            yScale.<span class="title function_">domain</span>(d3.<span class="title function_">range</span>(<span class="number">8</span>));</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 在渲染每个格子时设置渐变色的值</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> cells = svg.<span class="title function_">selectAll</span>(<span class="string">".cell"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">data</span>(d3.<span class="title function_">cross</span>(d3.<span class="title function_">range</span>(<span class="number">8</span>), d3.<span class="title function_">range</span>(<span class="number">45</span>)))</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">enter</span>().<span class="title function_">append</span>(<span class="string">"a"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"href"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? correspondingData.<span class="property">link</span> : <span class="string">"#"</span>; <span class="comment">// 设置链接，如果没有链接就是 "#"，即当前页面</span></span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">append</span>(<span class="string">"rect"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"class"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="string">"cell"</span> + (correspondingData &amp;&amp; correspondingData.<span class="property">word_count</span> &gt; <span class="number">0</span> ? <span class="string">" blue"</span> : <span class="string">""</span>);</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"x"</span>, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> <span class="title function_">xScale</span>(d[<span class="number">1</span>]); })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"y"</span>, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> <span class="title function_">yScale</span>(d[<span class="number">0</span>]); })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"width"</span>, cellSize)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"height"</span>, cellSize)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">style</span>(<span class="string">"fill"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? <span class="title function_">colorScale</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(correspondingData.<span class="property">word_count</span>, exponent)) : <span class="string">"#ccc"</span>;</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"rx"</span>, <span class="number">4</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"ry"</span>, <span class="number">4</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"data-word_count"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? correspondingData.<span class="property">word_count</span> : <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">on</span>(<span class="string">"click"</span>, <span class="keyword">function</span> (<span class="params">event, d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (correspondingData &amp;&amp; correspondingData.<span class="property">link</span>) {</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = correspondingData.<span class="property">link</span>;</span></span><br><span class="line"><span class="language-javascript">                    }</span></span><br><span class="line"><span class="language-javascript">                });</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">function</span> <span class="title function_">updateCellStyles</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> isDarkTheme = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">"dark-theme"</span>);</span></span><br><span class="line"><span class="language-javascript">                cells.<span class="title function_">style</span>(<span class="string">"stroke"</span>, isDarkTheme ? <span class="string">"#292a2d"</span> : <span class="string">"#fff"</span>)</span></span><br><span class="line"><span class="language-javascript">                    .<span class="title function_">style</span>(<span class="string">"stroke-width"</span>, <span class="string">"1px"</span>);</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">updateCellStyles</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">addEventListener</span>(<span class="string">"themechange"</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">updateCellStyles</span>();</span></span><br><span class="line"><span class="language-javascript">            });</span></span><br><span class="line"><span class="language-javascript">        });</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">767px</span>) {</span></span><br><span class="line"><span class="language-css">                <span class="selector-id">#heatmap-container</span> {</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">                }</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="comment">/* 在桌面端时隐藏 .avatar */</span></span></span><br><span class="line"><span class="language-css">            <span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">768px</span>) {</span></span><br><span class="line"><span class="language-css">                <span class="selector-class">.avatar</span> {</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">                }</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.cell</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke</span>: <span class="number">#fff</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke-width</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">fill</span>: <span class="number">#ccc</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: default;</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 添加这一行 */</span></span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.dark-theme</span> <span class="selector-class">.cell</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke</span>: <span class="number">#292a2d</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke-width</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">fill</span>: <span class="number">#a9a9b3</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: default;</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 添加这一行 */</span></span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.blue</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.dark-theme</span> <span class="selector-class">.blue</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nickname"</span>&gt;</span>&lt;%- theme.nickname %&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"description"</span>&gt;</span>&lt;%- markdown(theme.description) %&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"links"</span>&gt;</span></span><br><span class="line">            &lt;% if (theme.links !==undefined) { %&gt;</span><br><span class="line">                &lt;% for (var key in theme.links){ %&gt;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"link-item"</span> <span class="attr">title</span>=<span class="string">"&lt;%- key %&gt;"</span> <span class="attr">href</span>=<span class="string">"&lt;%= theme.links[key] %&gt;"</span>&gt;</span></span><br><span class="line">                        &lt;% if(theme.links_text_enable) { %&gt;</span><br><span class="line">                            &lt;%= key %&gt;</span><br><span class="line">                                &lt;% } %&gt;</span><br><span class="line">                                    &lt;% if(theme.links_icon_enable){ %&gt;</span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"iconfont icon-&lt;%- key.toLowerCase() %&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        &lt;% } %&gt;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    &lt;% } %&gt;</span><br><span class="line">                        &lt;% } %&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="鼠标悬停在格子上时，显示文章标题和日期"><a href="#鼠标悬停在格子上时，显示文章标题和日期" class="headerlink" title="鼠标悬停在格子上时，显示文章标题和日期"></a>鼠标悬停在格子上时，显示文章标题和日期</h1><p>因为原有的显示模式太不直观了，不知道哪个格子代表哪一天，又不想做成表格的形式，于是出此下策。效果如图：</p>
<img width="600" alt="效果图" src="https://github.com/greendolphindance/greendolphindance.github.io/assets/87912044/c5df99b3-5e79-4ce8-adb3-46a25d672065">

<p>修改后的代码如下：</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container profile-container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"intro"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"avatar"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&lt;%- url_for(theme.nav.Posts) %&gt;"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&lt;%- url_for(theme.avatar) %&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"heatmap-container"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"tooltip"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://d3js.org/d3.v5.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">"DOMContentLoaded"</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">function</span> <span class="title function_">getDateBefore</span>(<span class="params">days</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="keyword">new</span> <span class="title class_">Date</span>();</span></span><br><span class="line"><span class="language-javascript">                    currentDate.<span class="title function_">setDate</span>(currentDate.<span class="title function_">getDate</span>() - days);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> year = currentDate.<span class="title function_">getFullYear</span>();</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> month = <span class="title class_">String</span>(currentDate.<span class="title function_">getMonth</span>() + <span class="number">1</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> day = <span class="title class_">String</span>(currentDate.<span class="title function_">getDate</span>()).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="string">`<span class="subst">${year}</span>-<span class="subst">${month}</span>-<span class="subst">${day}</span>`</span>;</span></span><br><span class="line"><span class="language-javascript">                }</span></span><br><span class="line"><span class="language-javascript">            &lt;%</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">function</span> <span class="title function_">convertWordCount</span>(<span class="params">wordCountString</span>) {</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (!wordCountString) {</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">                        }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// Convert to string and check if the word count string contains 'k'</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> lowerCaseString = <span class="title class_">String</span>(wordCountString).<span class="title function_">toLowerCase</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (lowerCaseString.<span class="title function_">includes</span>(<span class="string">'k'</span>)) {</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> <span class="built_in">parseFloat</span>(lowerCaseString) * <span class="number">1000</span>;</span></span><br><span class="line"><span class="language-javascript">                        } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> <span class="built_in">parseFloat</span>(lowerCaseString);</span></span><br><span class="line"><span class="language-javascript">                        }</span></span><br><span class="line"><span class="language-javascript">                    }</span></span><br><span class="line"><span class="language-javascript">                    %&gt;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> data = [</span></span><br><span class="line"><span class="language-javascript">    &lt;% site.<span class="property">posts</span>.<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params">post</span>) { %&gt;</span></span><br><span class="line"><span class="language-javascript">                        {</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">date</span>: <span class="string">"&lt;%= post.date.format('YYYY-MM-DD') %&gt;"</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">word_count</span>: &lt;%= <span class="title function_">convertWordCount</span>(<span class="title function_">getWordCount</span>(post.<span class="property">content</span>)) %&gt;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">link</span>: <span class="string">"&lt;%= url_for(post.path) %&gt;"</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: <span class="string">"&lt;%= post.title %&gt;"</span></span></span><br><span class="line"><span class="language-javascript">        },</span></span><br><span class="line"><span class="language-javascript">    &lt;% }); %&gt;</span></span><br><span class="line"><span class="language-javascript">];</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> margin = { <span class="attr">top</span>: <span class="number">20</span>, <span class="attr">right</span>: <span class="number">20</span>, <span class="attr">bottom</span>: <span class="number">20</span>, <span class="attr">left</span>: <span class="number">20</span> };</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> containerWidth = <span class="number">600</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> cellSize = <span class="title class_">Math</span>.<span class="title function_">min</span>((containerWidth - margin.<span class="property">left</span> - margin.<span class="property">right</span>) / <span class="number">45</span>, (containerWidth - margin.<span class="property">top</span> - margin.<span class="property">bottom</span>) / <span class="number">8</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> width = cellSize * <span class="number">45</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> height = cellSize * <span class="number">8</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> svg = d3</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">select</span>(<span class="string">"#heatmap-container"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">append</span>(<span class="string">"svg"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"width"</span>, width + margin.<span class="property">left</span> + margin.<span class="property">right</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"height"</span>, height + margin.<span class="property">top</span> + margin.<span class="property">bottom</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">append</span>(<span class="string">"g"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"transform"</span>, <span class="string">"translate("</span> + margin.<span class="property">left</span> + <span class="string">","</span> + margin.<span class="property">top</span> + <span class="string">")"</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> xScale = d3.<span class="title function_">scaleBand</span>().<span class="title function_">range</span>([width, <span class="number">0</span>]).<span class="title function_">padding</span>(<span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> yScale = d3.<span class="title function_">scaleBand</span>().<span class="title function_">range</span>([height, <span class="number">0</span>]).<span class="title function_">padding</span>(<span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> exponent = <span class="number">0.3</span>; <span class="comment">// Adjust the exponent as needed</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> colorScale = d3.<span class="title function_">scaleSequential</span>(d3.<span class="title function_">interpolate</span>(<span class="string">"lightblue"</span>, <span class="string">"#2d96bd"</span>))</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">domain</span>([<span class="number">1</span>, <span class="title class_">Math</span>.<span class="title function_">pow</span>(d3.<span class="title function_">max</span>(data, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> d.<span class="property">word_count</span>; }), exponent)]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            xScale.<span class="title function_">domain</span>(d3.<span class="title function_">range</span>(<span class="number">45</span>));</span></span><br><span class="line"><span class="language-javascript">            yScale.<span class="title function_">domain</span>(d3.<span class="title function_">range</span>(<span class="number">8</span>));</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 在渲染每个格子时设置渐变色的值</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> cells = svg.<span class="title function_">selectAll</span>(<span class="string">".cell"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">data</span>(d3.<span class="title function_">cross</span>(d3.<span class="title function_">range</span>(<span class="number">8</span>), d3.<span class="title function_">range</span>(<span class="number">45</span>)))</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">enter</span>().<span class="title function_">append</span>(<span class="string">"a"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"href"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? correspondingData.<span class="property">link</span> : <span class="string">"#"</span>;</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">append</span>(<span class="string">"rect"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"class"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="string">"cell"</span> + (correspondingData &amp;&amp; correspondingData.<span class="property">word_count</span> &gt; <span class="number">0</span> ? <span class="string">" blue"</span> : <span class="string">""</span>);</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"x"</span>, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> <span class="title function_">xScale</span>(d[<span class="number">1</span>]); })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"y"</span>, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> <span class="title function_">yScale</span>(d[<span class="number">0</span>]); })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"width"</span>, cellSize)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"height"</span>, cellSize)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">style</span>(<span class="string">"fill"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? <span class="title function_">colorScale</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(correspondingData.<span class="property">word_count</span>, exponent)) : <span class="string">"#ccc"</span>;</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"rx"</span>, <span class="number">4</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"ry"</span>, <span class="number">4</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"data-word_count"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? correspondingData.<span class="property">word_count</span> : <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"title"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? currentDate + <span class="string">"\n"</span> + correspondingData.<span class="property">title</span> : <span class="string">""</span>;</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">on</span>(<span class="string">"click"</span>, <span class="keyword">function</span> (<span class="params">event, d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">0</span>] * <span class="number">45</span> + d[<span class="number">1</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (correspondingData &amp;&amp; correspondingData.<span class="property">link</span>) {</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// 点击直接跳转</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = correspondingData.<span class="property">link</span>;</span></span><br><span class="line"><span class="language-javascript">                    }</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">on</span>(<span class="string">"mouseover"</span>, <span class="keyword">function</span> (<span class="params">event, d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> title = d3.<span class="title function_">select</span>(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">"title"</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (title) {</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> tooltip = d3.<span class="title function_">select</span>(<span class="string">"#tooltip"</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// 显示日期和标题</span></span></span><br><span class="line"><span class="language-javascript">                        tooltip.<span class="title function_">transition</span>()</span></span><br><span class="line"><span class="language-javascript">                            .<span class="title function_">duration</span>(<span class="number">200</span>)</span></span><br><span class="line"><span class="language-javascript">                            .<span class="title function_">style</span>(<span class="string">"opacity"</span>, <span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> tooltipContent = title;</span></span><br><span class="line"><span class="language-javascript">                        tooltip.<span class="title function_">html</span>(tooltipContent);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// 获取蓝色格子的位置</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> cellBoundingBox = <span class="variable language_">this</span>.<span class="title function_">getBoundingClientRect</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// 计算 tooltip 的位置，使其中心线与蓝色格子的中心线对齐</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> tooltipWidth = tooltip.<span class="title function_">node</span>().<span class="property">offsetWidth</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> xPosition = cellBoundingBox.<span class="property">left</span> + cellBoundingBox.<span class="property">width</span> / <span class="number">2</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> yPosition = cellBoundingBox.<span class="property">top</span>;</span></span><br><span class="line"><span class="language-javascript">                        tooltip.<span class="title function_">style</span>(<span class="string">"left"</span>, xPosition + <span class="string">"px"</span>)</span></span><br><span class="line"><span class="language-javascript">                            .<span class="title function_">style</span>(<span class="string">"top"</span>, yPosition + <span class="string">"px"</span>);</span></span><br><span class="line"><span class="language-javascript">                    }</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">on</span>(<span class="string">"mouseout"</span>, <span class="keyword">function</span> (<span class="params">event, d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 隐藏 tooltip</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> tooltip = d3.<span class="title function_">select</span>(<span class="string">"#tooltip"</span>);</span></span><br><span class="line"><span class="language-javascript">                    tooltip.<span class="title function_">transition</span>()</span></span><br><span class="line"><span class="language-javascript">                        .<span class="title function_">duration</span>(<span class="number">200</span>)</span></span><br><span class="line"><span class="language-javascript">                        .<span class="title function_">style</span>(<span class="string">"opacity"</span>, <span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript">                        .<span class="title function_">on</span>(<span class="string">"end"</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                            <span class="comment">// 清除 tooltip 内容</span></span></span><br><span class="line"><span class="language-javascript">                            tooltip.<span class="title function_">html</span>(<span class="string">""</span>);</span></span><br><span class="line"><span class="language-javascript">                        });</span></span><br><span class="line"><span class="language-javascript">                });</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">function</span> <span class="title function_">updateCellStyles</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> isDarkTheme = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">"dark-theme"</span>);</span></span><br><span class="line"><span class="language-javascript">                cells.<span class="title function_">style</span>(<span class="string">"stroke"</span>, isDarkTheme ? <span class="string">"#292a2d"</span> : <span class="string">"#fff"</span>)</span></span><br><span class="line"><span class="language-javascript">                    .<span class="title function_">style</span>(<span class="string">"stroke-width"</span>, <span class="string">"1px"</span>);</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">updateCellStyles</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">addEventListener</span>(<span class="string">"themechange"</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">updateCellStyles</span>();</span></span><br><span class="line"><span class="language-javascript">            });</span></span><br><span class="line"><span class="language-javascript">        });</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">767px</span>) {</span></span><br><span class="line"><span class="language-css">                <span class="selector-id">#heatmap-container</span> {</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">                }</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="comment">/* 在桌面端时隐藏 .avatar */</span></span></span><br><span class="line"><span class="language-css">            <span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">768px</span>) {</span></span><br><span class="line"><span class="language-css">                <span class="selector-class">.avatar</span> {</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">                }</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.cell</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke</span>: <span class="number">#fff</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke-width</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">fill</span>: <span class="number">#ccc</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: default;</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 添加这一行 */</span></span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.dark-theme</span> <span class="selector-class">.cell</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke</span>: <span class="number">#292a2d</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke-width</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">fill</span>: <span class="number">#a9a9b3</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: default;</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 添加这一行 */</span></span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.blue</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.dark-theme</span> <span class="selector-class">.blue</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#tooltip</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: white;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#a9a9b3</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="number">3px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 调整文字与边框的间距 */</span></span></span><br><span class="line"><span class="language-css">                <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">font-size</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 调整字体大小 */</span></span></span><br><span class="line"><span class="language-css">                <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">100%</span>);</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 将框定位到正上方居中 */</span></span></span><br><span class="line"><span class="language-css">                <span class="attribute">line-height</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.dark-theme</span> <span class="selector-id">#tooltip</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: <span class="number">#292a2d</span>;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"tooltip"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nickname"</span>&gt;</span>&lt;%- theme.nickname %&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"description"</span>&gt;</span>&lt;%- markdown(theme.description) %&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"links"</span>&gt;</span></span><br><span class="line">            &lt;% if (theme.links !==undefined) { %&gt;</span><br><span class="line">                &lt;% for (var key in theme.links){ %&gt;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"link-item"</span> <span class="attr">title</span>=<span class="string">"&lt;%- key %&gt;"</span> <span class="attr">href</span>=<span class="string">"&lt;%= theme.links[key] %&gt;"</span>&gt;</span></span><br><span class="line">                        &lt;% if(theme.links_text_enable) { %&gt;</span><br><span class="line">                            &lt;%= key %&gt;</span><br><span class="line">                                &lt;% } %&gt;</span><br><span class="line">                                    &lt;% if(theme.links_icon_enable){ %&gt;</span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"iconfont icon-&lt;%- key.toLowerCase() %&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        &lt;% } %&gt;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    &lt;% } %&gt;</span><br><span class="line">                        &lt;% } %&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="2024-7-17调整"><a href="#2024-7-17调整" class="headerlink" title="2024-7-17调整"></a>2024-7-17调整</h1><p>这次主要调整了以下几个方面：</p>
<ul>
<li>夜间模式时，本来设定无文章的格子颜色为#a9a9b3，但不知为何没有生效。这次用了更细的选择器，使得颜色变为这个。</li>
<li>相应地，有文章格子的蓝色也调整为更深（保持渐变），否则会很不协调。</li>
</ul>
<p>修改了profile.ejs和script.js的内容。修改后者是因为，调整了这两项后，点击切换主题按钮，蓝色并没有变深或变浅，而是要刷新一下才会变化。所以需要定义一个themechange事件并监听它，每当这个事件被触发时，更新格子颜色。这就需要追溯到原本js文件里的toggleTheme函数，在函数执行时，添加一个themechange事件。</p>
<h2 id="修改后的profile-ejs"><a href="#修改后的profile-ejs" class="headerlink" title="修改后的profile.ejs"></a>修改后的profile.ejs</h2><figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"../fonts/iconfont2/iconfont.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container profile-container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"intro"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"avatar"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&lt;%- url_for(theme.nav.Posts) %&gt;"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&lt;%- url_for(theme.avatar) %&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"heatmap-container"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"tooltip"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://d3js.org/d3.v5.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">"DOMContentLoaded"</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">function</span> <span class="title function_">getDateBefore</span>(<span class="params">days</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="keyword">new</span> <span class="title class_">Date</span>();</span></span><br><span class="line"><span class="language-javascript">                    currentDate.<span class="title function_">setDate</span>(currentDate.<span class="title function_">getDate</span>() - days);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> year = currentDate.<span class="title function_">getFullYear</span>();</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> month = <span class="title class_">String</span>(currentDate.<span class="title function_">getMonth</span>() + <span class="number">1</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> day = <span class="title class_">String</span>(currentDate.<span class="title function_">getDate</span>()).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="string">`<span class="subst">${year}</span>-<span class="subst">${month}</span>-<span class="subst">${day}</span>`</span>;</span></span><br><span class="line"><span class="language-javascript">                }</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">                &lt;%</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">function</span> <span class="title function_">convertWordCount</span>(<span class="params">wordCountString</span>) {</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (!wordCountString) {</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">                        }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> lowerCaseString = <span class="title class_">String</span>(wordCountString).<span class="title function_">toLowerCase</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (lowerCaseString.<span class="title function_">includes</span>(<span class="string">'k'</span>)) {</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> <span class="built_in">parseFloat</span>(lowerCaseString) * <span class="number">1000</span>;</span></span><br><span class="line"><span class="language-javascript">                        } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> <span class="built_in">parseFloat</span>(lowerCaseString);</span></span><br><span class="line"><span class="language-javascript">                        }</span></span><br><span class="line"><span class="language-javascript">                    }</span></span><br><span class="line"><span class="language-javascript">                    %&gt;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> data = [</span></span><br><span class="line"><span class="language-javascript">                &lt;% site.<span class="property">posts</span>.<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params">post</span>) { %&gt;</span></span><br><span class="line"><span class="language-javascript">                        {</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">date</span>: <span class="string">"&lt;%= post.date.format('YYYY-MM-DD') %&gt;"</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">word_count</span>: &lt;%= <span class="title function_">convertWordCount</span>(<span class="title function_">getWordCount</span>(post.<span class="property">content</span>)) %&gt;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">link</span>: <span class="string">"&lt;%= url_for(post.path) %&gt;"</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: <span class="string">"&lt;%= post.title %&gt;"</span></span></span><br><span class="line"><span class="language-javascript">                    },</span></span><br><span class="line"><span class="language-javascript">                &lt;% }); %&gt;</span></span><br><span class="line"><span class="language-javascript">                ];</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> margin = { <span class="attr">top</span>: <span class="number">20</span>, <span class="attr">right</span>: <span class="number">20</span>, <span class="attr">bottom</span>: <span class="number">20</span>, <span class="attr">left</span>: <span class="number">20</span> };</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> containerWidth = <span class="number">600</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> cellSize = <span class="title class_">Math</span>.<span class="title function_">min</span>((containerWidth - margin.<span class="property">left</span> - margin.<span class="property">right</span>) / <span class="number">45</span>, (containerWidth - margin.<span class="property">top</span> - margin.<span class="property">bottom</span>) / <span class="number">7</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> width = cellSize * <span class="number">45</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> height = cellSize * <span class="number">7</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> svg = d3</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">select</span>(<span class="string">"#heatmap-container"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">append</span>(<span class="string">"svg"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"width"</span>, width + margin.<span class="property">left</span> + margin.<span class="property">right</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"height"</span>, height + margin.<span class="property">top</span> + margin.<span class="property">bottom</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">append</span>(<span class="string">"g"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"transform"</span>, <span class="string">"translate("</span> + margin.<span class="property">left</span> + <span class="string">","</span> + margin.<span class="property">top</span> + <span class="string">")"</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> xScale = d3.<span class="title function_">scaleBand</span>().<span class="title function_">range</span>([<span class="number">0</span>, width]).<span class="title function_">padding</span>(<span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> yScale = d3.<span class="title function_">scaleBand</span>().<span class="title function_">range</span>([<span class="number">0</span>, height]).<span class="title function_">padding</span>(<span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> exponent = <span class="number">0.35</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> colorScale = d3.<span class="title function_">scaleSequential</span>(d3.<span class="title function_">interpolate</span>(<span class="string">"lightblue"</span>, <span class="string">"#2d96bd"</span>))</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">domain</span>([<span class="number">1</span>, <span class="title class_">Math</span>.<span class="title function_">pow</span>(d3.<span class="title function_">max</span>(data, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> d.<span class="property">word_count</span>; }), exponent)]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> darkColorScale = d3.<span class="title function_">scaleSequential</span>(d3.<span class="title function_">interpolate</span>(<span class="string">"#4bafce"</span>, <span class="string">"#1a6d8a"</span>))</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">domain</span>([<span class="number">1</span>, <span class="title class_">Math</span>.<span class="title function_">pow</span>(d3.<span class="title function_">max</span>(data, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> d.<span class="property">word_count</span>; }), exponent)]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            xScale.<span class="title function_">domain</span>(d3.<span class="title function_">range</span>(<span class="number">44</span>, -<span class="number">1</span>, -<span class="number">1</span>));</span></span><br><span class="line"><span class="language-javascript">            yScale.<span class="title function_">domain</span>(d3.<span class="title function_">range</span>(<span class="number">6</span>, -<span class="number">1</span>, -<span class="number">1</span>));</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> cells = svg.<span class="title function_">selectAll</span>(<span class="string">".cell"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">data</span>(d3.<span class="title function_">cross</span>(d3.<span class="title function_">range</span>(<span class="number">7</span>), d3.<span class="title function_">range</span>(<span class="number">45</span>)).<span class="title function_">reverse</span>())</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">enter</span>().<span class="title function_">append</span>(<span class="string">"a"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"href"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">1</span>] * <span class="number">7</span> + d[<span class="number">0</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? correspondingData.<span class="property">link</span> : <span class="string">"#"</span>;</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">append</span>(<span class="string">"rect"</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"class"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">1</span>] * <span class="number">7</span> + d[<span class="number">0</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="string">"cell"</span> + (correspondingData &amp;&amp; correspondingData.<span class="property">word_count</span> &gt; <span class="number">0</span> ? <span class="string">" blue"</span> : <span class="string">""</span>);</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"x"</span>, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> <span class="title function_">xScale</span>(d[<span class="number">1</span>]); })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"y"</span>, <span class="keyword">function</span> (<span class="params">d</span>) { <span class="keyword">return</span> <span class="title function_">yScale</span>(d[<span class="number">0</span>]); })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"width"</span>, cellSize)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"height"</span>, cellSize)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">style</span>(<span class="string">"fill"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">1</span>] * <span class="number">7</span> + d[<span class="number">0</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> isDarkTheme = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">"dark-theme"</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? (isDarkTheme ? <span class="title function_">darkColorScale</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(correspondingData.<span class="property">word_count</span>, exponent)) : <span class="title function_">colorScale</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(correspondingData.<span class="property">word_count</span>, exponent))) : <span class="string">"#ccc"</span>;</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"rx"</span>, <span class="number">4</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"ry"</span>, <span class="number">4</span>)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"data-word_count"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">1</span>] * <span class="number">7</span> + d[<span class="number">0</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? correspondingData.<span class="property">word_count</span> : <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">attr</span>(<span class="string">"title"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">1</span>] * <span class="number">7</span> + d[<span class="number">0</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> correspondingData ? currentDate + <span class="string">"\n"</span> + correspondingData.<span class="property">title</span> : <span class="string">""</span>;</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">on</span>(<span class="string">"click"</span>, <span class="keyword">function</span> (<span class="params">event, d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">1</span>] * <span class="number">7</span> + d[<span class="number">0</span>]);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (correspondingData &amp;&amp; correspondingData.<span class="property">link</span>) {</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = correspondingData.<span class="property">link</span>;</span></span><br><span class="line"><span class="language-javascript">                    }</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">on</span>(<span class="string">"mouseover"</span>, <span class="keyword">function</span> (<span class="params">event, d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> title = d3.<span class="title function_">select</span>(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">"title"</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (title) {</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> tooltip = d3.<span class="title function_">select</span>(<span class="string">"#tooltip"</span>);</span></span><br><span class="line"><span class="language-javascript">                        tooltip.<span class="title function_">transition</span>()</span></span><br><span class="line"><span class="language-javascript">                            .<span class="title function_">duration</span>(<span class="number">200</span>)</span></span><br><span class="line"><span class="language-javascript">                            .<span class="title function_">style</span>(<span class="string">"opacity"</span>, <span class="number">0.9</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> tooltipContent = title;</span></span><br><span class="line"><span class="language-javascript">                        tooltip.<span class="title function_">html</span>(tooltipContent);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> cellBoundingBox = <span class="variable language_">this</span>.<span class="title function_">getBoundingClientRect</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> tooltipWidth = tooltip.<span class="title function_">node</span>().<span class="property">offsetWidth</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> xPosition = cellBoundingBox.<span class="property">left</span> + cellBoundingBox.<span class="property">width</span> / <span class="number">2</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> yPosition = cellBoundingBox.<span class="property">top</span>;</span></span><br><span class="line"><span class="language-javascript">                        tooltip.<span class="title function_">style</span>(<span class="string">"left"</span>, xPosition + <span class="string">"px"</span>)</span></span><br><span class="line"><span class="language-javascript">                            .<span class="title function_">style</span>(<span class="string">"top"</span>, yPosition + <span class="string">"px"</span>);</span></span><br><span class="line"><span class="language-javascript">                    }</span></span><br><span class="line"><span class="language-javascript">                })</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">on</span>(<span class="string">"mouseout"</span>, <span class="keyword">function</span> (<span class="params">event, d</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> tooltip = d3.<span class="title function_">select</span>(<span class="string">"#tooltip"</span>);</span></span><br><span class="line"><span class="language-javascript">                    tooltip.<span class="title function_">transition</span>()</span></span><br><span class="line"><span class="language-javascript">                        .<span class="title function_">duration</span>(<span class="number">200</span>)</span></span><br><span class="line"><span class="language-javascript">                        .<span class="title function_">style</span>(<span class="string">"opacity"</span>, <span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript">                        .<span class="title function_">on</span>(<span class="string">"end"</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                            tooltip.<span class="title function_">html</span>(<span class="string">""</span>);</span></span><br><span class="line"><span class="language-javascript">                        });</span></span><br><span class="line"><span class="language-javascript">                });</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">function</span> <span class="title function_">updateCellStyles</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> isDarkTheme = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">"dark-theme"</span>);</span></span><br><span class="line"><span class="language-javascript">                cells.<span class="title function_">style</span>(<span class="string">"stroke"</span>, isDarkTheme ? <span class="string">"#292a2d"</span> : <span class="string">"#fff"</span>)</span></span><br><span class="line"><span class="language-javascript">                    .<span class="title function_">style</span>(<span class="string">"stroke-width"</span>, <span class="string">"1px"</span>)</span></span><br><span class="line"><span class="language-javascript">                    .<span class="title function_">style</span>(<span class="string">"fill"</span>, <span class="keyword">function</span> (<span class="params">d</span>) {</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> currentDate = <span class="title function_">getDateBefore</span>(d[<span class="number">1</span>] * <span class="number">7</span> + d[<span class="number">0</span>]);</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">var</span> correspondingData = data.<span class="title function_">find</span>(<span class="function"><span class="params">entry</span> =&gt;</span> entry.<span class="property">date</span> === currentDate);</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> correspondingData ? (isDarkTheme ? <span class="title function_">darkColorScale</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(correspondingData.<span class="property">word_count</span>, exponent)) : <span class="title function_">colorScale</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(correspondingData.<span class="property">word_count</span>, exponent))) : <span class="string">"#ccc"</span>;</span></span><br><span class="line"><span class="language-javascript">                    });</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">updateCellStyles</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">addEventListener</span>(<span class="string">"themechange"</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">updateCellStyles</span>();</span></span><br><span class="line"><span class="language-javascript">            });</span></span><br><span class="line"><span class="language-javascript">            });</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">767px</span>) {</span></span><br><span class="line"><span class="language-css">                <span class="selector-id">#heatmap-container</span> {</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">                }</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="comment">/* 在桌面端时隐藏 .avatar */</span></span></span><br><span class="line"><span class="language-css">            <span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">768px</span>) {</span></span><br><span class="line"><span class="language-css">                <span class="selector-class">.avatar</span> {</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">                }</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.cell</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke</span>: <span class="number">#fff</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke-width</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">fill</span>: <span class="number">#ccc</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: default;</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 添加这一行 */</span></span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.dark-theme</span> <span class="selector-class">.cell</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke</span>: <span class="number">#292a2d</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">stroke-width</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: default;</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 添加这一行 */</span></span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.dark-theme</span> <span class="selector-class">.cell</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.blue</span>) {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">fill</span>: <span class="number">#a9a9b3</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.blue</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.dark-theme</span> <span class="selector-class">.blue</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#tooltip</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: white;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#a9a9b3</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="number">3px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 调整文字与边框的间距 */</span></span></span><br><span class="line"><span class="language-css">                <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">font-size</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 调整字体大小 */</span></span></span><br><span class="line"><span class="language-css">                <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">100%</span>);</span></span><br><span class="line"><span class="language-css">                <span class="comment">/* 将框定位到正上方居中 */</span></span></span><br><span class="line"><span class="language-css">                <span class="attribute">line-height</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.dark-theme</span> <span class="selector-id">#tooltip</span> {</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: <span class="number">#292a2d</span>;</span></span><br><span class="line"><span class="language-css">            }</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nickname"</span>&gt;</span>&lt;%- theme.nickname %&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"description"</span>&gt;</span>&lt;%- markdown(theme.description) %&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"links"</span>&gt;</span></span><br><span class="line">            &lt;% if (theme.links !==undefined) { %&gt;</span><br><span class="line">                &lt;% for (var key in theme.links){ %&gt;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"link-item"</span> <span class="attr">title</span>=<span class="string">"&lt;%- key %&gt;"</span> <span class="attr">href</span>=<span class="string">"&lt;%= theme.links[key] %&gt;"</span>&gt;</span></span><br><span class="line">                        &lt;% if(theme.links_text_enable) { %&gt;</span><br><span class="line">                            &lt;%= key %&gt;</span><br><span class="line">                                &lt;% } %&gt;</span><br><span class="line">                                    &lt;% if(theme.links_icon_enable){ %&gt;</span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"iconfont icon-&lt;%- key.toLowerCase() %&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        &lt;% } %&gt;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    &lt;% } %&gt;</span><br><span class="line">                        &lt;% } %&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="修改前后的script-js"><a href="#修改前后的script-js" class="headerlink" title="修改前后的script.js"></a>修改前后的script.js</h2><h3 id="修改前"><a href="#修改前" class="headerlink" title="修改前"></a>修改前</h3><figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// declaraction of document.ready() function.</span></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">var</span> ie = !!(<span class="variable language_">window</span>.<span class="property">attachEvent</span> &amp;&amp; !<span class="variable language_">window</span>.<span class="property">opera</span>);</span><br><span class="line">    <span class="keyword">var</span> wk = <span class="regexp">/webkit\/(\d+)/i</span>.<span class="title function_">test</span>(navigator.<span class="property">userAgent</span>) &amp;&amp; (<span class="title class_">RegExp</span>.<span class="property">$1</span> &lt; <span class="number">525</span>);</span><br><span class="line">    <span class="keyword">var</span> fn = [];</span><br><span class="line">    <span class="keyword">var</span> run = <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; fn.<span class="property">length</span>; i++) fn[i]();</span><br><span class="line">    };</span><br><span class="line">    <span class="keyword">var</span> d = <span class="variable language_">document</span>;</span><br><span class="line">    d.<span class="property">ready</span> = <span class="keyword">function</span> (<span class="params">f</span>) {</span><br><span class="line">        <span class="keyword">if</span> (!ie &amp;&amp; !wk &amp;&amp; d.<span class="property">addEventListener</span>)</span><br><span class="line">            <span class="keyword">return</span> d.<span class="title function_">addEventListener</span>(<span class="string">'DOMContentLoaded'</span>, f, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (fn.<span class="title function_">push</span>(f) &gt; <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (ie)</span><br><span class="line">            (<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    d.<span class="property">documentElement</span>.<span class="title function_">doScroll</span>(<span class="string">'left'</span>);</span><br><span class="line">                    <span class="title function_">run</span>();</span><br><span class="line">                } <span class="keyword">catch</span> (err) {</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="variable language_">arguments</span>.<span class="property">callee</span>, <span class="number">0</span>);</span><br><span class="line">                }</span><br><span class="line">            })();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (wk)</span><br><span class="line">            <span class="keyword">var</span> t = <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">                <span class="keyword">if</span> (<span class="regexp">/^(loaded|complete)$/</span>.<span class="title function_">test</span>(d.<span class="property">readyState</span>))</span><br><span class="line">                    <span class="built_in">clearInterval</span>(t), <span class="title function_">run</span>();</span><br><span class="line">            }, <span class="number">0</span>);</span><br><span class="line">    };</span><br><span class="line">})();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">ready</span>(</span><br><span class="line">    <span class="comment">// toggleTheme function.</span></span><br><span class="line">    <span class="comment">// this script shouldn't be changed.</span></span><br><span class="line">    <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="keyword">var</span> _Blog = <span class="variable language_">window</span>.<span class="property">_Blog</span> || {};</span><br><span class="line">        <span class="keyword">const</span> currentTheme = <span class="variable language_">window</span>.<span class="property">localStorage</span> &amp;&amp; <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">'theme'</span>);</span><br><span class="line">        <span class="keyword">const</span> isDark = currentTheme === <span class="string">'dark'</span>;</span><br><span class="line">        <span class="keyword">const</span> pagebody = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">'body'</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (isDark) {</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"switch_default"</span>).<span class="property">checked</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// mobile</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"mobile-toggle-theme"</span>).<span class="property">innerText</span> = <span class="string">"· Dark"</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"switch_default"</span>).<span class="property">checked</span> = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">// mobile</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"mobile-toggle-theme"</span>).<span class="property">innerText</span> = <span class="string">"· Light"</span></span><br><span class="line">        }</span><br><span class="line">        _Blog.<span class="property">toggleTheme</span> = <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">            <span class="keyword">if</span> (isDark) {</span><br><span class="line">                pagebody.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">'dark-theme'</span>);</span><br><span class="line">                <span class="comment">// mobile</span></span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"mobile-toggle-theme"</span>).<span class="property">innerText</span> = <span class="string">"· Dark"</span></span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                pagebody.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">'dark-theme'</span>);</span><br><span class="line">                <span class="comment">// mobile</span></span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"mobile-toggle-theme"</span>).<span class="property">innerText</span> = <span class="string">"· Light"</span></span><br><span class="line">            }</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">'toggleBtn'</span>)[<span class="number">0</span>].<span class="title function_">addEventListener</span>(<span class="string">'click'</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">                <span class="keyword">if</span> (pagebody.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">'dark-theme'</span>)) {</span><br><span class="line">                    pagebody.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">'dark-theme'</span>);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    pagebody.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">'dark-theme'</span>);</span><br><span class="line">                }</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">localStorage</span> &amp;&amp;</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">'theme'</span>, <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">'dark-theme'</span>) ? <span class="string">'dark'</span> : <span class="string">'light'</span>,)</span><br><span class="line">            })</span><br><span class="line">            <span class="comment">// moblie</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'mobile-toggle-theme'</span>).<span class="title function_">addEventListener</span>(<span class="string">'click'</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">                <span class="keyword">if</span> (pagebody.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">'dark-theme'</span>)) {</span><br><span class="line">                    pagebody.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">'dark-theme'</span>);</span><br><span class="line">                    <span class="comment">// mobile</span></span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"mobile-toggle-theme"</span>).<span class="property">innerText</span> = <span class="string">"· Light"</span></span><br><span class="line"></span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    pagebody.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">'dark-theme'</span>);</span><br><span class="line">                    <span class="comment">// mobile</span></span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"mobile-toggle-theme"</span>).<span class="property">innerText</span> = <span class="string">"· Dark"</span></span><br><span class="line">                }</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">localStorage</span> &amp;&amp;</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">'theme'</span>, <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">'dark-theme'</span>) ? <span class="string">'dark'</span> : <span class="string">'light'</span>,)</span><br><span class="line">            })</span><br><span class="line">        };</span><br><span class="line">        _Blog.<span class="title function_">toggleTheme</span>();</span><br><span class="line">        <span class="comment">// ready function.</span></span><br><span class="line">    }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure>

<h3 id="修改后"><a href="#修改后" class="headerlink" title="修改后"></a>修改后</h3><figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// declaraction of document.ready() function.</span></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">var</span> ie = !!(<span class="variable language_">window</span>.<span class="property">attachEvent</span> &amp;&amp; !<span class="variable language_">window</span>.<span class="property">opera</span>);</span><br><span class="line">    <span class="keyword">var</span> wk = <span class="regexp">/webkit\/(\d+)/i</span>.<span class="title function_">test</span>(navigator.<span class="property">userAgent</span>) &amp;&amp; (<span class="title class_">RegExp</span>.<span class="property">$1</span> &lt; <span class="number">525</span>);</span><br><span class="line">    <span class="keyword">var</span> fn = [];</span><br><span class="line">    <span class="keyword">var</span> run = <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; fn.<span class="property">length</span>; i++) fn[i]();</span><br><span class="line">    };</span><br><span class="line">    <span class="keyword">var</span> d = <span class="variable language_">document</span>;</span><br><span class="line">    d.<span class="property">ready</span> = <span class="keyword">function</span> (<span class="params">f</span>) {</span><br><span class="line">        <span class="keyword">if</span> (!ie &amp;&amp; !wk &amp;&amp; d.<span class="property">addEventListener</span>)</span><br><span class="line">            <span class="keyword">return</span> d.<span class="title function_">addEventListener</span>(<span class="string">'DOMContentLoaded'</span>, f, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (fn.<span class="title function_">push</span>(f) &gt; <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (ie)</span><br><span class="line">            (<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    d.<span class="property">documentElement</span>.<span class="title function_">doScroll</span>(<span class="string">'left'</span>);</span><br><span class="line">                    <span class="title function_">run</span>();</span><br><span class="line">                } <span class="keyword">catch</span> (err) {</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="variable language_">arguments</span>.<span class="property">callee</span>, <span class="number">0</span>);</span><br><span class="line">                }</span><br><span class="line">            })();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (wk)</span><br><span class="line">            <span class="keyword">var</span> t = <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">                <span class="keyword">if</span> (<span class="regexp">/^(loaded|complete)$/</span>.<span class="title function_">test</span>(d.<span class="property">readyState</span>))</span><br><span class="line">                    <span class="built_in">clearInterval</span>(t), <span class="title function_">run</span>();</span><br><span class="line">            }, <span class="number">0</span>);</span><br><span class="line">    };</span><br><span class="line">})();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">ready</span>(</span><br><span class="line">    <span class="comment">// toggleTheme function.</span></span><br><span class="line">    <span class="comment">// this script shouldn't be changed.</span></span><br><span class="line">    <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="keyword">var</span> _Blog = <span class="variable language_">window</span>.<span class="property">_Blog</span> || {};</span><br><span class="line">        <span class="keyword">const</span> currentTheme = <span class="variable language_">window</span>.<span class="property">localStorage</span> &amp;&amp; <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">'theme'</span>);</span><br><span class="line">        <span class="keyword">const</span> isDark = currentTheme === <span class="string">'dark'</span>;</span><br><span class="line">        <span class="keyword">const</span> pagebody = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">'body'</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (isDark) {</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"switch_default"</span>).<span class="property">checked</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// mobile</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"mobile-toggle-theme"</span>).<span class="property">innerText</span> = <span class="string">"· Dark"</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"switch_default"</span>).<span class="property">checked</span> = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">// mobile</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"mobile-toggle-theme"</span>).<span class="property">innerText</span> = <span class="string">"· Light"</span></span><br><span class="line">        }</span><br><span class="line">        _Blog.<span class="property">toggleTheme</span> = <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">            <span class="keyword">if</span> (isDark) {</span><br><span class="line">                pagebody.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">'dark-theme'</span>);</span><br><span class="line">                <span class="comment">// mobile</span></span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"mobile-toggle-theme"</span>).<span class="property">innerText</span> = <span class="string">"· Dark"</span></span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                pagebody.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">'dark-theme'</span>);</span><br><span class="line">                <span class="comment">// mobile</span></span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"mobile-toggle-theme"</span>).<span class="property">innerText</span> = <span class="string">"· Light"</span></span><br><span class="line">            }</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">'toggleBtn'</span>)[<span class="number">0</span>].<span class="title function_">addEventListener</span>(<span class="string">'click'</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">                <span class="keyword">if</span> (pagebody.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">'dark-theme'</span>)) {</span><br><span class="line">                    pagebody.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">'dark-theme'</span>);</span><br><span class="line">                    <span class="comment">// Dispatch the custom 'themechange' event</span></span><br><span class="line">                    <span class="keyword">var</span> event = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">'themechange'</span>);</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">dispatchEvent</span>(event);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    pagebody.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">'dark-theme'</span>);</span><br><span class="line">                    <span class="comment">// Dispatch the custom 'themechange' event</span></span><br><span class="line">                    <span class="keyword">var</span> event = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">'themechange'</span>);</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">dispatchEvent</span>(event);</span><br><span class="line">                }</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">localStorage</span> &amp;&amp;</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">'theme'</span>, <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">'dark-theme'</span>) ? <span class="string">'dark'</span> : <span class="string">'light'</span>,)</span><br><span class="line">            })</span><br><span class="line">            <span class="comment">// moblie</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'mobile-toggle-theme'</span>).<span class="title function_">addEventListener</span>(<span class="string">'click'</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">                <span class="keyword">if</span> (pagebody.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">'dark-theme'</span>)) {</span><br><span class="line">                    pagebody.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">'dark-theme'</span>);</span><br><span class="line">                    <span class="comment">// mobile</span></span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"mobile-toggle-theme"</span>).<span class="property">innerText</span> = <span class="string">"· Light"</span></span><br><span class="line">                    <span class="comment">// Dispatch the custom 'themechange' event</span></span><br><span class="line">                    <span class="keyword">var</span> event = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">'themechange'</span>);</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">dispatchEvent</span>(event);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    pagebody.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">'dark-theme'</span>);</span><br><span class="line">                    <span class="comment">// mobile</span></span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"mobile-toggle-theme"</span>).<span class="property">innerText</span> = <span class="string">"· Dark"</span></span><br><span class="line">                    <span class="comment">// Dispatch the custom 'themechange' event</span></span><br><span class="line">                    <span class="keyword">var</span> event = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">'themechange'</span>);</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">dispatchEvent</span>(event);</span><br><span class="line">                }</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">localStorage</span> &amp;&amp;</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">'theme'</span>, <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">'dark-theme'</span>) ? <span class="string">'dark'</span> : <span class="string">'light'</span>,)</span><br><span class="line">            })</span><br><span class="line">        };</span><br><span class="line">        _Blog.<span class="title function_">toggleTheme</span>();</span><br><span class="line">        <span class="comment">// ready function.</span></span><br><span class="line">    }</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
                            </div>

                            
                                <section class="post-copyright">
                                    
                                            
                                                    
                                                            

                                </section>
                                
                                    <section class="post-tags">
                                        <div>
                                            <span>标签：</span>
                                            <span class="tag">
                                                
                                                    
                                                        <a href="/tags/%E5%8D%9A%E5%AE%A2/"># 博客</a>
                                                        
                                                            
                                            </span>
                                        </div>
                                        <div>
                                            <a href="javascript:window.history.back();">返回</a>
                                            <span>· </span>
                                            <a href="/">主页</a>
                                        </div>
                                    </section>
                                    <section class="post-nav">
                                        
                                            <a class="prev" rel="prev" href="/2024/01/26/%E5%88%B6%E4%BD%9Chexo%E6%A0%87%E7%AD%BE%E5%A2%99%EF%BC%882%EF%BC%89/">制作hexo标签墙（2）</a>
                                            
                                                
                                                    <a class="next" rel="next" href="/2024/01/19/%E8%A7%A3%E5%86%B3%E2%80%9C%E8%87%B4%E5%91%BD%E9%94%99%E8%AF%AF%EF%BC%9A%E6%97%A0%E6%B3%95%E8%AF%BB%E5%8F%96%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E2%80%9D%E9%97%AE%E9%A2%98/">解决“致命错误：无法读取远程仓库”问题</a>
                                                    
                                    </section>

                                    <section style="margin-top: 100px" class="row">
                                        <div class="widget">
    
        
            <div class="recommended_posts">
                <h3>
                    可能相关的文章<span class="driven-by">（由 <a
                            target="_blank" rel="noopener" href="https://github.com/huiwang/hexo-recommended-posts">跨博客文章推荐插件</a> 驱动）</span>
                </h3>
                <ul>
                    
                        <li><a href="https://greendolphindance.com/2024/01/26/%E5%88%B6%E4%BD%9Chexo%E6%A0%87%E7%AD%BE%E5%A2%99%EF%BC%882%EF%BC%89/">
                                制作hexo标签墙（2）
                            </a></li>
                        
                        <li><a href="https://greendolphindance.com/2024/01/19/%E8%A7%A3%E5%86%B3%E2%80%9C%E8%87%B4%E5%91%BD%E9%94%99%E8%AF%AF%EF%BC%9A%E6%97%A0%E6%B3%95%E8%AF%BB%E5%8F%96%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E2%80%9D%E9%97%AE%E9%A2%98/">
                                解决“致命错误：无法读取远程仓库”问题
                            </a></li>
                        
                        <li><a href="https://greendolphindance.com/2024/01/12/%E9%95%BF%E6%B2%99%E4%BA%BA%E7%9A%84%E9%95%BF%E6%B2%99%E5%9B%9B%E6%97%A5%E6%B8%B8/">
                                长沙人的长沙四日游
                            </a></li>
                        
                </ul>
            </div>
            
</div>
                                    </section>


                                    <script>
                                        document.addEventListener('DOMContentLoaded', function () {
                                            function getGiscusTheme() {
                                                const theme = document.body.classList.contains('dark-theme') ? 'dark' : 'light';
                                                return theme === 'dark' ? 'noborder_dark' : 'noborder_light';
                                            }

                                            function setGiscusTheme() {
                                                function sendMessage(message) {
                                                    const iframe = document.querySelector('iframe.giscus-frame');
                                                    if (!iframe) return;
                                                    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
                                                }
                                                sendMessage({
                                                    setConfig: {
                                                        theme: getGiscusTheme(),
                                                    },
                                                });
                                            }

                                            function handleToggle() {
                                                location.reload();
                                            }

                                            // Update giscus theme when theme switcher is clicked
                                            const toggleDesktop = document.querySelector('label[for="switch_default"]');
                                            const toggleMobile = document.querySelector('#mobile-toggle-theme');

                                            if (toggleDesktop) {
                                                toggleDesktop.addEventListener('click', function () {
                                                    setGiscusTheme();
                                                });
                                            }

                                            if (toggleMobile) {
                                                toggleMobile.addEventListener('click', function () {
                                                    setGiscusTheme();
                                                });
                                            }

                                            // Wait for 1000ms (1 second) before loading the Giscus comments to ensure theme is set
                                            setTimeout(() => {
                                                const giscusAttributes = {
                                                    "src": "https://giscus.app/client.js",
                                                    "data-repo": "greendolphindance/greendolphindance.github.io",
                                                    "data-repo-id": "R_kgDOKc-MwA",
                                                    "data-category": "General",
                                                    "data-category-id": "DIC_kwDOKc-MwM4CZ8oe",
                                                    "data-mapping": "url",
                                                    "data-strict": "0",
                                                    "data-reactions-enabled": "1",
                                                    "data-emit-metadata": "0",
                                                    "data-input-position": "top",
                                                    "data-theme": getGiscusTheme(),
                                                    "data-lang": "zh-CN",
                                                    "crossorigin": "anonymous",
                                                };

                                                // Dynamically create script tag
                                                const giscusScript = document.createElement("script");
                                                Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));

                                                // Append the script tag to the <article> element
                                                document.querySelector('article').appendChild(giscusScript);
                                            }, 1000);
                                        });

                                    </script>

                                    <button id="tocButton" style="display: none;">
                                        <svg t="1697879152903" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                            xmlns="http://www.w3.org/2000/svg" p-id="5387" width="32" height="32">
                                            <path
                                                d="M 863.113 0 H 160.887 A 161.064 161.064 0 0 0 0 160.887 v 702.225 a 161.064 161.064 0 0 0 160.887 160.887 h 702.225 a 161.064 161.064 0 0 0 160.887 -160.887 V 160.887 a 161.064 161.064 0 0 0 -160.887 -160.887 Z M 242.94 725.908 h -6.06545 a 24.1331 24.1331 0 0 1 0 -48.2662 H 242.94 a 24.1331 24.1331 0 0 1 0 48.2662 Z m 0 -193.58 h -6.06545 a 24.1331 24.1331 0 0 1 0 -48.2662 H 242.94 a 24.1331 24.1331 0 0 1 0 48.2662 Z M 242.94 333.037 h -6.06545 a 24.1331 24.1331 0 0 1 0 -48.2662 H 242.94 a 24.1331 24.1331 0 0 1 0 48.2662 Z m 534.146 392.839 H 416.087 a 24.1331 24.1331 0 0 1 0 -48.2662 h 360.854 a 24.1331 24.1331 0 0 1 0 48.2662 Z m 0 -193.58 H 416.087 a 24.1331 24.1331 0 0 1 0 -48.2662 h 360.854 a 24.1331 24.1331 0 0 1 0 48.2662 Z M 777.086 333.037 H 416.087 a 24.1331 24.1331 0 0 1 0 -48.2662 h 360.854 a 24.1331 24.1331 0 0 1 0 48.2662 Z"
                                                fill="#8a8a8a" p-id="5388"></path>
                                    </button>

                                    <div class="overlay" id="overlay" onclick="hideToc()"></div>

                                    <script>
                                        function hideToc() {
                                            var toc = document.querySelector('.js-toc');
                                            var overlay = document.getElementById('overlay');
                                            var body = document.body;

                                            toc.style.display = 'none'; // 隐藏目录
                                            overlay.style.display = 'none'; // 隐藏遮罩层
                                            body.style.overflow = ''; // 启用页面滚动
                                        }
                                        window.onload = function () {

                                            var toc = document.querySelector('.js-toc');
                                            var tocButton = document.getElementById('tocButton');
                                            if (toc) {
                                                // 根据 toc 内容的有无显示或隐藏目录按钮
                                                tocButton.style.display = toc.innerText.trim() === '' ? 'none' : 'block';
                                            } else {
                                                tocButton.style.display = 'none';
                                            }
                                        };

                                        function checkWindowSize() {
                                            var windowWidth = window.innerWidth;
                                            var toc = document.querySelector('.js-toc');
                                            var tocButton = document.getElementById('tocButton');

                                            if (windowWidth > 1379 || toc.innerText.trim() === '') {
                                                tocButton.style.display = 'none';
                                            } else {
                                                tocButton.style.display = 'block';
                                            }
                                        }


                                        // 点击tocButton时执行的函数
                                        document.getElementById('tocButton').addEventListener('click', function () {
                                            var toc = document.querySelector('.js-toc');
                                            var overlay = document.getElementById('overlay');
                                            var body = document.body;

                                            if (toc.style.display === 'none' || toc.style.display === '') {
                                                toc.style.display = 'block'; // 显示目录
                                                overlay.style.display = 'block'; // 显示遮罩层
                                                body.style.overflow = 'hidden'; // 禁用页面滚动
                                            } else {
                                                hideToc();
                                            }
                                        });


                                        // 窗口大小变化时检查窗口宽度
                                        window.onresize = checkWindowSize;
                                    </script>

                        </article>

</div>

<style>
    .dark-theme .post-content code {
        background: none !important;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var codeBlocks = document.querySelectorAll('article pre');

        codeBlocks.forEach(function (codeBlock) {
            var copyButton = document.createElement('button');
            copyButton.className = 'copy-button';
            copyButton.innerText = 'Copy';

            // Check if the code block is in the article content
            if (codeBlock.closest('article')) {
                codeBlock.parentNode.parentNode.style.position = 'relative'; // Update this line to select parent of span (pre)
                codeBlock.parentNode.parentNode.appendChild(copyButton); // Update this line to select parent of span (pre) 

                var isCopying = false;

                copyButton.addEventListener('click', function () {
                    if (!isCopying) {
                        var codeText = codeBlock.innerText;
                        navigator.clipboard.writeText(codeText).then(function () {
                            copyButton.innerText = 'Copied!';
                            isCopying = true;
                            setTimeout(function () {
                                copyButton.innerText = 'Copy';
                                isCopying = false;
                            }, 1500);
                        }).catch(function (err) {
                            console.error('Copy failed', err);
                        });
                    }
                });
            }
        });
    });
</script>

<style>
    .copy-button {
        position: absolute;
        top: 0;
        right: 0;
        background-color: #2d96bd;
        color: #fff;
        border: none;
        border-radius: 10%;
        padding: 5px 10px;
        cursor: pointer;
    }

    button,
    input,
    optgroup,
    select,
    textarea {
        font-size: 75%;
    }
</style>

    <div class="js-toc"></div>
    <div class="post-content"> <!-- 这里的class需要根据自身情况修改 -->
        <!-- 博客文章内容将在这里渲染 -->
    </div>
    <!-- recommended posts -->
            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <!-- <img style="height:16px!important; margin-left:1px;vertical-align: middle; position: relative; top: -1px;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1">
                <img style="height:16px!important;margin-left:1px;vertical-align: middle; position: relative; top: -1px;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1">
                <img style="height:16px!important;margin-left:1px;vertical-align: middle; position: relative; top: -1px;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"> -->
        <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1">
            <svg xmlns="http://www.w3.org/2000/svg"
                style="height:12px; width:12px; margin-left:0.5px;vertical-align: middle; position: relative; top: -0.5px;"
                class="cc-logo" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" id="Layer_1" x="0px" y="0px"
                width="64px" height="64px" viewBox="5.5 -3.5 64 64" enable-background="new 5.5 -3.5 64 64"
                xml:space="preserve">
                <g>
                    <circle fill="none" cx="37.785" cy="28.501" r="28.836" />
                    <path
                        d="M37.441-3.5c8.951,0,16.572,3.125,22.857,9.372c3.008,3.009,5.295,6.448,6.857,10.314   c1.561,3.867,2.344,7.971,2.344,12.314c0,4.381-0.773,8.486-2.314,12.313c-1.543,3.828-3.82,7.21-6.828,10.143   c-3.123,3.085-6.666,5.448-10.629,7.086c-3.961,1.638-8.057,2.457-12.285,2.457s-8.276-0.808-12.143-2.429   c-3.866-1.618-7.333-3.961-10.4-7.027c-3.067-3.066-5.4-6.524-7-10.372S5.5,32.767,5.5,28.5c0-4.229,0.809-8.295,2.428-12.2   c1.619-3.905,3.972-7.4,7.057-10.486C21.08-0.394,28.565-3.5,37.441-3.5z M37.557,2.272c-7.314,0-13.467,2.553-18.458,7.657   c-2.515,2.553-4.448,5.419-5.8,8.6c-1.354,3.181-2.029,6.505-2.029,9.972c0,3.429,0.675,6.734,2.029,9.913   c1.353,3.183,3.285,6.021,5.8,8.516c2.514,2.496,5.351,4.399,8.515,5.715c3.161,1.314,6.476,1.971,9.943,1.971   c3.428,0,6.75-0.665,9.973-1.999c3.219-1.335,6.121-3.257,8.713-5.771c4.99-4.876,7.484-10.99,7.484-18.344   c0-3.543-0.648-6.895-1.943-10.057c-1.293-3.162-3.18-5.98-5.654-8.458C50.984,4.844,44.795,2.272,37.557,2.272z M37.156,23.187   l-4.287,2.229c-0.458-0.951-1.019-1.619-1.685-2c-0.667-0.38-1.286-0.571-1.858-0.571c-2.856,0-4.286,1.885-4.286,5.657   c0,1.714,0.362,3.084,1.085,4.113c0.724,1.029,1.791,1.544,3.201,1.544c1.867,0,3.181-0.915,3.944-2.743l3.942,2   c-0.838,1.563-2,2.791-3.486,3.686c-1.484,0.896-3.123,1.343-4.914,1.343c-2.857,0-5.163-0.875-6.915-2.629   c-1.752-1.752-2.628-4.19-2.628-7.313c0-3.048,0.886-5.466,2.657-7.257c1.771-1.79,4.009-2.686,6.715-2.686   C32.604,18.558,35.441,20.101,37.156,23.187z M55.613,23.187l-4.229,2.229c-0.457-0.951-1.02-1.619-1.686-2   c-0.668-0.38-1.307-0.571-1.914-0.571c-2.857,0-4.287,1.885-4.287,5.657c0,1.714,0.363,3.084,1.086,4.113   c0.723,1.029,1.789,1.544,3.201,1.544c1.865,0,3.18-0.915,3.941-2.743l4,2c-0.875,1.563-2.057,2.791-3.541,3.686   c-1.486,0.896-3.105,1.343-4.857,1.343c-2.896,0-5.209-0.875-6.941-2.629c-1.736-1.752-2.602-4.19-2.602-7.313   c0-3.048,0.885-5.466,2.658-7.257c1.77-1.79,4.008-2.686,6.713-2.686C51.117,18.558,53.938,20.101,55.613,23.187z" />
                </g>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg"
                style="height:12px; width:12px; margin-left:0.5px;vertical-align: middle; position: relative; top: -0.5px;"
                class="att-logo" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" id="Layer_1" x="0px" y="0px"
                width="64px" height="64px" viewBox="5.5 -3.5 64 64" enable-background="new 5.5 -3.5 64 64"
                xml:space="preserve">
                <g>
                    <circle fill="none" cx="37.637" cy="28.806" r="28.276" />
                    <g>
                        <path
                            d="M37.443-3.5c8.988,0,16.57,3.085,22.742,9.257C66.393,11.967,69.5,19.548,69.5,28.5c0,8.991-3.049,16.476-9.145,22.456    C53.879,57.319,46.242,60.5,37.443,60.5c-8.649,0-16.153-3.144-22.514-9.43C8.644,44.784,5.5,37.262,5.5,28.5    c0-8.761,3.144-16.342,9.429-22.742C21.101-0.415,28.604-3.5,37.443-3.5z M37.557,2.272c-7.276,0-13.428,2.553-18.457,7.657    c-5.22,5.334-7.829,11.525-7.829,18.572c0,7.086,2.59,13.22,7.77,18.398c5.181,5.182,11.352,7.771,18.514,7.771    c7.123,0,13.334-2.607,18.629-7.828c5.029-4.838,7.543-10.952,7.543-18.343c0-7.276-2.553-13.465-7.656-18.571    C50.967,4.824,44.795,2.272,37.557,2.272z M46.129,20.557v13.085h-3.656v15.542h-9.944V33.643h-3.656V20.557    c0-0.572,0.2-1.057,0.599-1.457c0.401-0.399,0.887-0.6,1.457-0.6h13.144c0.533,0,1.01,0.2,1.428,0.6    C45.918,19.5,46.129,19.986,46.129,20.557z M33.042,12.329c0-3.008,1.485-4.514,4.458-4.514s4.457,1.504,4.457,4.514    c0,2.971-1.486,4.457-4.457,4.457S33.042,15.3,33.042,12.329z" />
                    </g>
                </g>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg"
                style="height:12px; width:12px; margin-left:0.5px;vertical-align: middle; position: relative; top: -0.5px;"
                class="non-logo" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" id="Layer_1" x="0px" y="0px"
                width="64px" height="64px" viewBox="5.5 -3.5 64 64" enable-background="new 5.5 -3.5 64 64"
                xml:space="preserve">
                <g>
                    <circle fill="none" cx="37.47" cy="28.736" r="29.471" />
                    <g>
                        <path
                            d="M37.442-3.5c8.99,0,16.571,3.085,22.743,9.256C66.393,11.928,69.5,19.509,69.5,28.5c0,8.992-3.048,16.476-9.145,22.458    C53.88,57.32,46.241,60.5,37.442,60.5c-8.686,0-16.19-3.162-22.513-9.485C8.644,44.728,5.5,37.225,5.5,28.5    c0-8.762,3.144-16.343,9.429-22.743C21.1-0.414,28.604-3.5,37.442-3.5z M12.7,19.872c-0.952,2.628-1.429,5.505-1.429,8.629    c0,7.086,2.59,13.22,7.77,18.4c5.219,5.144,11.391,7.715,18.514,7.715c7.201,0,13.409-2.608,18.63-7.829    c1.867-1.79,3.332-3.657,4.398-5.602l-12.056-5.371c-0.421,2.02-1.439,3.667-3.057,4.942c-1.622,1.276-3.535,2.011-5.744,2.2    v4.915h-3.714v-4.915c-3.543-0.036-6.782-1.312-9.714-3.827l4.4-4.457c2.094,1.942,4.476,2.913,7.143,2.913    c1.104,0,2.048-0.246,2.83-0.743c0.78-0.494,1.172-1.312,1.172-2.457c0-0.801-0.287-1.448-0.858-1.943l-3.085-1.315l-3.771-1.715    l-5.086-2.229L12.7,19.872z M37.557,2.214c-7.276,0-13.428,2.571-18.457,7.714c-1.258,1.258-2.439,2.686-3.543,4.287L27.786,19.7    c0.533-1.676,1.542-3.019,3.029-4.028c1.484-1.009,3.218-1.571,5.2-1.686V9.071h3.715v4.915c2.934,0.153,5.6,1.143,8,2.971    l-4.172,4.286c-1.793-1.257-3.619-1.885-5.486-1.885c-0.991,0-1.876,0.191-2.656,0.571c-0.781,0.381-1.172,1.029-1.172,1.943    c0,0.267,0.095,0.533,0.285,0.8l4.057,1.83l2.8,1.257l5.144,2.285l16.397,7.314c0.535-2.248,0.801-4.533,0.801-6.857    c0-7.353-2.552-13.543-7.656-18.573C51.005,4.785,44.831,2.214,37.557,2.214z" />
                    </g>
                </g>
            </svg>
        </a>
        由 <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic"
            target="_blank">Chic</a> <span id="qudong">驱动</span>
        </span>
        <br>
        <!-- Add the SVG logo wrapped in a link -->
        <a href="https://www.travellings.cn/go.html" target="_blank" style="display:inline-block;">
            <svg xmlns="http://www.w3.org/2000/svg" class="kaiwang" height="16" width="14" viewBox="0 0 448 512"
                style="height:12px; width:12px; ;vertical-align: middle; position: relative; top: -0.5px;">
                <!-- SVG Path -->
                <path
                    d="M96 0C43 0 0 43 0 96V352c0 48 35.2 87.7 81.1 94.9l-46 46C28.1 499.9 33.1 512 43 512H82.7c8.5 0 16.6-3.4 22.6-9.4L160 448H288l54.6 54.6c6 6 14.1 9.4 22.6 9.4H405c10 0 15-12.1 7.9-19.1l-46-46c46-7.1 81.1-46.9 81.1-94.9V96c0-53-43-96-96-96H96zM64 128c0-17.7 14.3-32 32-32h80c17.7 0 32 14.3 32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V128zM272 96h80c17.7 0 32 14.3 32 32v96c0 17.7-14.3 32-32 32H272c-17.7 0-32-14.3-32-32V128c0-17.7 14.3-32 32-32zM64 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zm288-32a32 32 0 1 1 0 64 32 32 0 1 1 0-64z" />
            </svg>
        </a>
        <a href="https://icp.gov.moe/?keyword=20230468" target="_blank"><span id="moe-text">萌ICP备20230468号</span></a>
        <a href="https://travel.moe/go.html" title="异次元之旅-跃迁-我们一起去萌站成员的星球旅行吧！" style=" display:inline-block;"
            target=" _blank">
            <svg t="1702427100869" class="moe-icon" viewBox="0 0 1024 1024" version="1.1"
                xmlns="http://www.w3.org/2000/svg" p-id="1841"
                style="height:14px; width:14px; vertical-align: middle; position: relative; top: -1px;">
                <path d="M598.1 392.7m-56.8 0a56.8 56.8 0 1 0 113.6 0 56.8 56.8 0 1 0-113.6 0Z" p-id="1842"></path>
                <path d="M434.6 392.7m-33.8 0a33.8 33.8 0 1 0 67.6 0 33.8 33.8 0 1 0-67.6 0Z" p-id="1843"></path>
                <path
                    d="M236.6 828.1c-68.7 0-123.9-20.2-152.4-67.5-37.3-62-14.6-148.9 63.9-244.8 4.6-5.4 19.2-21.7 37-30 22.4-10.5 49-0.8 59.5 21.6 10.4 22.4 0.8 49-21.6 59.5-0.7 0.6-4.7 4.6-6 6.2-59.9 73.2-67.7 122-56 141.3 28.6 47.6 208 33.8 423.7-96.2 99.8-60.2 184-131.7 237-201.2 41.8-54.9 59.9-105.4 45.9-128.6-12.7-21.1-57.8-29.5-117.6-22-12.1 1.5-25 3.7-38.1 6.5-24.3 5.1-47.9-10.4-53-34.6-5.1-24.2 10.4-47.9 34.6-53 15.6-3.3 30.8-5.8 45.4-7.7 127.9-16.1 182.3 26.3 205.4 64.7 35.1 58.2 16.8 139.6-51.4 229-59.7 78.3-152.8 157.6-262.1 223.5-129.9 78.3-280.7 133.3-394.2 133.3z"
                    p-id="1844"></path>
                <path
                    d="M529.8 874.7c-200.4 0-363.5-163.1-363.5-363.5s163.1-363.5 363.5-363.5 363.5 163.1 363.5 363.5-163 363.5-363.5 363.5z m0-637.5c-151.1 0-274 122.9-274 274s122.9 274 274 274 274-122.9 274-274-122.9-274-274-274z"
                    p-id="1845"></path>
            </svg></a>
        <br>
        <i class="ri-time-line"></i>
        <span id="runtime_span"></span>
        <script type="text/javascript">
            function show_runtime() {
                window.setTimeout("show_runtime()", 1000);
                X = new Date("10/06/2023 12:34:50");
                Y = new Date();
                T = (Y.getTime() - X.getTime());
                M = 24 * 60 * 60 * 1000;
                a = T / M;
                A = Math.floor(a);
                b = (a - A) * 24;
                B = Math.floor(b);
                c = (b - B) * 60;
                C = Math.floor((b - B) * 60);
                D = Math.floor((c - C) * 60);
                runtime_span.innerHTML = "已运行 " + A + "天" + B + "小时" + C + "分" + D + "秒"
            }
            show_runtime();
        </script>
        <span class="post-count">
            96.8k
        </span>
        <span>
            <!-- Existing Creative Commons images and links -->
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span
                id="busuanzi_value_site_uv"></span>
            <a href="http://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target="_blank"
                rel="license noopener noreferrer" style="display:inline-block;">
    </div>

    <style>
        @media screen and (max-width: 767px) {
            .footer {
                margin-bottom: 1.5rem;
                /* 将页脚上移1rem */
            }
        }

        .dark-theme .kaiwang {
            fill: #a9a9b2;
        }

        /* Default color (black) for day mode for moe-icon */
        .moe-icon {
            fill: black;
        }

        /* Color (#A9A9B2) for dark theme for moe-icon */
        .dark-theme .moe-icon {
            fill: #A9A9B2;
        }

        /* Apply fill color based on currentColor for all logos */
        .cc-logo path,
        .att-logo path,
        .non-logo path {
            fill: currentColor;
        }

        /* Default color (black) for day mode for all logos */
        .cc-logo path,
        .att-logo path,
        .non-logo path {
            color: black;
        }

        /* Color (#A9A9B2) for dark theme for all logos */
        .dark-theme .cc-logo path,
        .dark-theme .att-logo path,
        .dark-theme .non-logo path {
            color: #A9A9B2;
        }

        #footer .footer {
            font-size: 12px !important;
        }

        /* 页脚的基本样式 */
        .footer {
            font-size: 12px;
        }

        /* 桌面端样式 */
        @media screen and (min-width: 768px) {
            .footer {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }

            .footer>div>span,
            .footer>div>a,
            .footer>div>i {
                display: inline-block;
            }

            .footer>div>br {
                display: none;
                /* 隐藏换行符 */
            }

            .footer>div>script {
                display: none;
                /* 隐藏 script 标签 */
            }
        }

        /* 移动端样式，无需特别处理 */

        .non-logo,
        #busuanzi_value_site_uv,
        #qudong,
        .kaiwang,
        #moe-text,
        .moe-icon,
        #runtime_span,
        .post-count {
            margin-right: 5px;
        }
    </style>

    <div id="totop" style="bottom:60px;cursor: pointer;">
    <a title="返回顶部">
        <svg t="1697771647324" class="icon back-top-svg" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2324" width="32px" height="32px">
            <path d="M946.494 754.216c19.445-19.445 19.445-51.265 0-70.711L547.355 284.368c-19.445-19.445-51.265-19.445-70.711 0L77.506 683.506c-19.445 19.445-19.445 51.265 0 70.711" p-id="2325" fill="#8a8a8a"></path>
        </svg>
    </a>
</div>




        <script src="/js/totop.js"></script>

        <!-- require APlayer -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
        <script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
        <!-- require MetingJS -->
        <script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

        <div class="aplayer no-destroy" style="display: block; text-align: left" data-id="8793002560"
            data-server="netease" data-type="playlist" data-mini="true" data-fixed="true" data-autoplay="false"
            data-order="random" data-lrctype="-1"> </div>

        <style>
            body.dark-theme .aplayer-list {
                border-color: #414345 !important;
            }

            body.dark-theme .aplayer-info {
                border-color: #414345 !important;
            }

            body.dark-theme .aplayer-miniswitcher {
                background: #414345;
                border-color: #414345;
            }

            body.dark-theme .aplayer-body {
                background: #292a2d !important;
            }

            body.dark-theme .aplayer {
                box-shadow: none !important;
            }

            body.dark-theme .aplayer-list ol li:first-child {
                border-top: none;
            }
        </style>
</footer>
    </div>
    </script>

    <!-- 搜索功能 -->
    <!-- Chic/layout.ejs -->
    <div id="u-search">
        <div class="modal">
            <div class="modal-header">
                <div class="container">
                    <form id="u-search-modal-form" class="u-search-modal-form">
                        <button type="submit" class="form-submit-btn">
                            <img src="/" class="search-btn-img" />
                        </button>
                        <input placeholder="搜索内容..." class="form-input" id="modal-form-input">
                    </form>
                    <a class="modal-close">x</a>
                </div>
                <div class="search-loading">
                    <div class="search-loading-bar"></div>
                </div>
            </div>
            <div class="modal-body">
            </div>
        </div>
        <div class="modal-overlay"></div>
    </div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot/dist/tocbot.css" />
    <script src="https://cdn.jsdelivr.net/npm/tocbot/dist/tocbot.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            tocbot.init({
                tocSelector: '.js-toc',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4',
            });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const savedTheme = localStorage.getItem('theme');
            console.log("Saved theme: ", savedTheme); // 输出保存的主题

            const userPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            console.log("User prefers dark theme: ", userPrefersDark); // 输出用户的系统偏好

            let useDarkMode;
            if (savedTheme === 'dark' || savedTheme === 'light') { // 当有明确的保存主题时
                useDarkMode = savedTheme === 'dark';
            } else {
                useDarkMode = userPrefersDark; // 默认使用系统偏好
            }

            console.log("Using dark theme: ", useDarkMode); // 输出是否使用暗主题

            document.body.classList.toggle('dark-theme', useDarkMode); // 应用或移除 dark-theme 类

            const themeToggleCheckbox = document.getElementById('switch_default');
            if (themeToggleCheckbox) {
                themeToggleCheckbox.checked = useDarkMode;
            }

            themeToggleCheckbox.addEventListener('change', function () {
                const isChecked = themeToggleCheckbox.checked;
                console.log("Checkbox is checked: ", isChecked); // 输出复选框的状态

                document.body.classList.toggle('dark-theme', isChecked);
                localStorage.setItem('theme', isChecked ? 'dark' : 'light');
            });
        });
    </script>

    <script>
        document.querySelector('.js-toc').addEventListener('scroll', function (e) {
            var tocList = document.querySelector('.toc-list');
            var maxHeight = tocList.scrollHeight - this.clientHeight + 20; // 计算最大可滚动高度
            if (this.scrollTop >= maxHeight) {
                this.scrollTop = maxHeight; // 如果滚动超过最大高度，则设置滚动位置为最大高度
            }
        });
    </script>

</body>

</html>