<div class="container">
    <%# toc %>
        <%if(theme.post_toc_enable && toc(page.content).length!==0){%>
            <%- partial('_partial/toc') %>
                <%}%>

                    <%# article %>
                        <article class="post-wrap">
                            <header class="post-header">
                                <h1 class="post-title">
                                    <%= page.title %>
                                </h1>
                                <% if(theme.post_meta_enable){ %>
                                    <div class="post-meta">

                                        <% if(theme.post_author_enable && config.author){ %>
                                            Author: <a itemprop="author" rel="author" href="/"><%- config.author %></a>
                                            <% } %>

                                                <% if(page.date && theme.post_date_enable){ %>
                                                    <span class="post-time">

                                                        发表时间: <a href="#"><%- date(page.date, theme.date_format)
                                                                %>&nbsp;&nbsp;<%- time(page.date,
                                                                    theme.time_format)%></a>
                                                    </span>
                                                    <% } %>

                                                        <% if(page.updated){ %>
                                                            <span class="updated-time">
                                                                最后更新: <a href="#"><%- date(page.updated,
                                                                        theme.date_format) %>&nbsp;&nbsp;<%-
                                                                            time(page.updated, theme.time_format)%></a>
                                                            </span>
                                                            <% } %>



                                                                <% if(page.categories.length!==0 &&
                                                                    theme.post_category_enable){ %>

                                                                    <span class="post-category">

                                                                        分类:

                                                                        <% page.categories.forEach(item=>{ %>

                                                                            <a href="<%- url_for(item.path) %>"><%-
                                                                                    item.name %></a>

                                                                            <% }) %>

                                                                    </span>

                                                                    <% } %>



                                                                        <% if(page.content &&
                                                                            theme.post_wordcount_enable){ %>

                                                                            <span class="post-count">

                                                                                字数:

                                                                                <a href="">
                                                                                    <%= wordcount(page.content) %>
                                                                                </a>

                                                                            </span>

                                                                            <% } %>



                                                                                <% if(page.content &&
                                                                                    theme.post_min2read_enable){ %>

                                                                                    <span class="post-count">

                                                                                        阅读时长:

                                                                                        <a href="">
                                                                                            <%= min2read(post.content)
                                                                                                %>min
                                                                                        </a>

                                                                                    </span>

                                                                                    <% } %>

                                    </div>
                                    <% } %>
                            </header>

                            <div class="post-content">
                                <%- page.content %>
                            </div>

                            <% if(theme.post_copyright_enable){ %>
                                <section class="post-copyright">
                                    <% if(theme.post_copyright_author_enable){ %>
                                        <p class="copyright-item">
                                            <span>Author:</span>
                                            <span><%- config.author %></span>
                                        </p>
                                        <% } %>
                                            <% if(theme.post_copyright_permalink_enable){ %>
                                                <p class="copyright-item">
                                                    <span>Permalink:</span>
                                                    <span><a href="<%- page.permalink %>"><%- page.permalink
                                                                %></a></span>
                                                </p>
                                                <% } %>
                                                    <% if(theme.post_copyright_license_enable){ %>
                                                        <p class="copyright-item">
                                                            <span>License:</span>
                                                            <span><%- theme.post_copyright_license_text %></span>
                                                        </p>
                                                        <% } %>
                                                            <% if(theme.post_copyright_slogan_enable){ %>
                                                                <p class="copyright-item">
                                                                    <span>Slogan:</span>
                                                                    <span><%- theme.post_copyright_slogan_text %></span>
                                                                </p>
                                                                <% } %>

                                </section>
                                <% } %>
                                    <section class="post-tags">
                                        <div>
                                            <span>标签：</span>
                                            <span class="tag">
                                                <% if(page.tags.length!==0){%>
                                                    <% page.tags.forEach(item=>{ %>
                                                        <a href="<%- url_for(item.path) %>"># <%- item.name %></a>
                                                        <% }) %>
                                                            <% } %>
                                            </span>
                                        </div>
                                        <div>
                                            <a href="javascript:window.history.back();">返回</a>
                                            <span>· </span>
                                            <a href="<%- config.root %>">主页</a>
                                        </div>
                                    </section>
                                    <section class="post-nav">
                                        <% if(post.prev){ %>
                                            <a class="prev" rel="prev" href="<%- url_for(post.prev.path)%>"><%-
                                                    post.prev.title%></a>
                                            <% } %>
                                                <% if(post.next){ %>
                                                    <a class="next" rel="next" href="<%- url_for(post.next.path)%>"><%-
                                                            post.next.title%></a>
                                                    <% } %>
                                    </section>

                                    <section style="margin-top: 100px" class="row">
                                        <%- partial('_widget/intellij_recommended', {page: page, site: site}) %>
                                    </section>


                                    <script>
                                        document.addEventListener('DOMContentLoaded', function () {
                                            function getGiscusTheme() {
                                                const theme = document.body.classList.contains('dark-theme') ? 'dark' : 'light';
                                                return theme === 'dark' ? 'noborder_dark' : 'noborder_light';
                                            }

                                            function setGiscusTheme() {
                                                function sendMessage(message) {
                                                    const iframe = document.querySelector('iframe.giscus-frame');
                                                    if (!iframe) return;
                                                    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
                                                }
                                                sendMessage({
                                                    setConfig: {
                                                        theme: getGiscusTheme(),
                                                    },
                                                });
                                            }

                                            function handleToggle() {
                                                location.reload();
                                            }

                                            // Update giscus theme when theme switcher is clicked
                                            const toggleDesktop = document.querySelector('label[for="switch_default"]');
                                            const toggleMobile = document.querySelector('#mobile-toggle-theme');

                                            if (toggleDesktop) {
                                                toggleDesktop.addEventListener('click', function () {
                                                    setGiscusTheme();
                                                });
                                            }

                                            if (toggleMobile) {
                                                toggleMobile.addEventListener('click', function () {
                                                    setGiscusTheme();
                                                });
                                            }

                                            // Wait for 1000ms (1 second) before loading the Giscus comments to ensure theme is set
                                            setTimeout(() => {
                                                const giscusAttributes = {
                                                    "src": "https://giscus.app/client.js",
                                                    "data-repo": "greendolphindance/greendolphindance.github.io",
                                                    "data-repo-id": "R_kgDOKc-MwA",
                                                    "data-category": "General",
                                                    "data-category-id": "DIC_kwDOKc-MwM4CZ8oe",
                                                    "data-mapping": "url",
                                                    "data-strict": "0",
                                                    "data-reactions-enabled": "1",
                                                    "data-emit-metadata": "0",
                                                    "data-input-position": "top",
                                                    "data-theme": getGiscusTheme(),
                                                    "data-lang": "zh-CN",
                                                    "crossorigin": "anonymous",
                                                };

                                                // Dynamically create script tag
                                                const giscusScript = document.createElement("script");
                                                Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));

                                                // Append the script tag to the <article> element
                                                document.querySelector('article').appendChild(giscusScript);
                                            }, 1000);
                                        });

                                    </script>

                                    <button id="tocButton" style="display: none;">
                                        <svg t="1697879152903" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                            xmlns="http://www.w3.org/2000/svg" p-id="5387" width="32" height="32">
                                            <path
                                                d="M 863.113 0 H 160.887 A 161.064 161.064 0 0 0 0 160.887 v 702.225 a 161.064 161.064 0 0 0 160.887 160.887 h 702.225 a 161.064 161.064 0 0 0 160.887 -160.887 V 160.887 a 161.064 161.064 0 0 0 -160.887 -160.887 Z M 242.94 725.908 h -6.06545 a 24.1331 24.1331 0 0 1 0 -48.2662 H 242.94 a 24.1331 24.1331 0 0 1 0 48.2662 Z m 0 -193.58 h -6.06545 a 24.1331 24.1331 0 0 1 0 -48.2662 H 242.94 a 24.1331 24.1331 0 0 1 0 48.2662 Z M 242.94 333.037 h -6.06545 a 24.1331 24.1331 0 0 1 0 -48.2662 H 242.94 a 24.1331 24.1331 0 0 1 0 48.2662 Z m 534.146 392.839 H 416.087 a 24.1331 24.1331 0 0 1 0 -48.2662 h 360.854 a 24.1331 24.1331 0 0 1 0 48.2662 Z m 0 -193.58 H 416.087 a 24.1331 24.1331 0 0 1 0 -48.2662 h 360.854 a 24.1331 24.1331 0 0 1 0 48.2662 Z M 777.086 333.037 H 416.087 a 24.1331 24.1331 0 0 1 0 -48.2662 h 360.854 a 24.1331 24.1331 0 0 1 0 48.2662 Z"
                                                fill="#8a8a8a" p-id="5388"></path>
                                    </button>

                                    <div class="overlay" id="overlay" onclick="hideToc()"></div>

                                    <script>
                                        function hideToc() {
                                            var toc = document.querySelector('.js-toc');
                                            var overlay = document.getElementById('overlay');
                                            var body = document.body;

                                            toc.style.display = 'none'; // 隐藏目录
                                            overlay.style.display = 'none'; // 隐藏遮罩层
                                            body.style.overflow = ''; // 启用页面滚动
                                        }
                                        window.onload = function () {

                                            var toc = document.querySelector('.js-toc');
                                            var tocButton = document.getElementById('tocButton');
                                            if (toc) {
                                                // 根据 toc 内容的有无显示或隐藏目录按钮
                                                tocButton.style.display = toc.innerText.trim() === '' ? 'none' : 'block';
                                            } else {
                                                tocButton.style.display = 'none';
                                            }
                                        };

                                        function checkWindowSize() {
                                            var windowWidth = window.innerWidth;
                                            var toc = document.querySelector('.js-toc');
                                            var tocButton = document.getElementById('tocButton');

                                            if (windowWidth > 1379 || toc.innerText.trim() === '') {
                                                tocButton.style.display = 'none';
                                            } else {
                                                tocButton.style.display = 'block';
                                            }
                                        }


                                        // 点击tocButton时执行的函数
                                        document.getElementById('tocButton').addEventListener('click', function () {
                                            var toc = document.querySelector('.js-toc');
                                            var overlay = document.getElementById('overlay');
                                            var body = document.body;

                                            if (toc.style.display === 'none' || toc.style.display === '') {
                                                toc.style.display = 'block'; // 显示目录
                                                overlay.style.display = 'block'; // 显示遮罩层
                                                body.style.overflow = 'hidden'; // 禁用页面滚动
                                            } else {
                                                hideToc();
                                            }
                                        });


                                        // 窗口大小变化时检查窗口宽度
                                        window.onresize = checkWindowSize;
                                    </script>

                        </article>

</div>

<style>
    .dark-theme .post-content code {
        background: none !important;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var codeBlocks = document.querySelectorAll('article pre');

        codeBlocks.forEach(function (codeBlock) {
            var copyButton = document.createElement('button');
            copyButton.className = 'copy-button';
            copyButton.innerText = 'Copy';

            // Check if the code block is in the article content
            if (codeBlock.closest('article')) {
                codeBlock.parentNode.parentNode.style.position = 'relative'; // Update this line to select parent of span (pre)
                codeBlock.parentNode.parentNode.appendChild(copyButton); // Update this line to select parent of span (pre) 

                var isCopying = false;

                copyButton.addEventListener('click', function () {
                    if (!isCopying) {
                        var codeText = codeBlock.innerText;
                        navigator.clipboard.writeText(codeText).then(function () {
                            copyButton.innerText = 'Copied!';
                            isCopying = true;
                            setTimeout(function () {
                                copyButton.innerText = 'Copy';
                                isCopying = false;
                            }, 1500);
                        }).catch(function (err) {
                            console.error('Copy failed', err);
                        });
                    }
                });
            }
        });
    });
</script>

<style>
    .copy-button {
        position: absolute;
        top: 0;
        right: 0;
        background-color: #2d96bd;
        color: #fff;
        border: none;
        border-radius: 10%;
        padding: 5px 10px;
        cursor: pointer;
    }

    button,
    input,
    optgroup,
    select,
    textarea {
        font-size: 75%;
    }
</style>